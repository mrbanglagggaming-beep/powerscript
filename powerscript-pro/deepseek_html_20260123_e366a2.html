<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PowerScript Pro v4.0 - উন্নত PowerShell টুলস ম্যানেজমেন্ট</title>
    
    <!-- Cynthia Theme CSS -->
    <style>
        /* ===== CYNTHIA CSS THEME ===== */
        :root {
            --cynthia-primary: #00f3ff;
            --cynthia-secondary: #9d00ff;
            --cynthia-accent: #ffd700;
            --cynthia-dark: #0a0a1a;
            --cynthia-neon: #ff00ff;
            --cynthia-success: #00ff9d;
            --cynthia-danger: #ff4757;
            --cynthia-warning: #ffa502;
            --cynthia-info: #2ed573;
            --cynthia-dark-light: #151530;
            --cynthia-light-bg: #f8f9fa;
            --cynthia-light-text: #333333;
            --cynthia-card-light: #ffffff;
        }

        /* থিম টগল এনিমেশন */
        @keyframes themeSwitch {
            0% { opacity: 0.8; transform: scale(0.95); }
            100% { opacity: 1; transform: scale(1); }
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: var(--cynthia-dark);
            color: white;
            min-height: 100vh;
            overflow-x: hidden;
            transition: background-color 0.5s ease, color 0.5s ease;
        }

        body.light-mode {
            background: var(--cynthia-light-bg);
            color: var(--cynthia-light-text);
        }

        /* ===== FIXED STYLES ===== */
        .container {
            max-width: 1440px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* নেভিগেশন */
        .navbar {
            background: rgba(10, 10, 26, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(0, 243, 255, 0.2);
            padding: 15px 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            transition: all 0.5s ease;
        }

        .light-mode .navbar {
            background: rgba(248, 249, 250, 0.95);
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .navbar-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 20px;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 800;
            background: linear-gradient(90deg, var(--cynthia-primary), var(--cynthia-secondary));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .light-mode .logo {
            background: linear-gradient(90deg, #0066cc, #9d00ff);
            -webkit-background-clip: text;
            background-clip: text;
        }

        .nav-links {
            display: flex;
            gap: 20px;
            align-items: center;
            list-style: none;
        }

        .nav-link {
            color: rgba(255, 255, 255, 0.85);
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 8px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }

        .light-mode .nav-link {
            color: rgba(0, 0, 0, 0.85);
        }

        .nav-link:hover {
            color: white;
            background: rgba(0, 243, 255, 0.1);
        }

        .light-mode .nav-link:hover {
            color: black;
            background: rgba(0, 102, 204, 0.1);
        }

        .nav-link.active {
            color: white;
            background: rgba(0, 243, 255, 0.2);
        }

        .light-mode .nav-link.active {
            color: black;
            background: rgba(0, 102, 204, 0.2);
        }

        /* থিম টগল */
        .theme-toggle {
            background: transparent;
            border: none;
            color: var(--cynthia-accent);
            font-size: 1.2rem;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            transition: all 0.3s;
        }

        .theme-toggle:hover {
            background: rgba(0, 243, 255, 0.1);
        }

        /* বাটন স্টাইল */
        .btn {
            padding: 12px 24px;
            border-radius: 8px;
            border: none;
            font-family: inherit;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            background: linear-gradient(135deg, var(--cynthia-primary), var(--cynthia-secondary));
            color: white;
        }

        .light-mode .btn {
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 243, 255, 0.3);
        }

        .light-mode .btn:hover {
            box-shadow: 0 8px 24px rgba(0, 102, 204, 0.3);
        }

        /* পেজ সিস্টেম */
        .page {
            display: none;
            padding: 40px 0;
            min-height: calc(100vh - 200px);
            animation: themeSwitch 0.3s ease;
        }

        .page.active {
            display: block;
        }

        /* টুল কার্ড */
        .tools-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .tool-card {
            background: rgba(21, 21, 48, 0.8);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(0, 243, 255, 0.1);
            transition: all 0.3s;
            animation: themeSwitch 0.3s ease;
        }

        .light-mode .tool-card {
            background: var(--cynthia-card-light);
            border: 1px solid rgba(0, 0, 0, 0.1);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        .tool-card:hover {
            transform: translateY(-5px);
            border-color: var(--cynthia-primary);
            box-shadow: 0 8px 24px rgba(0, 243, 255, 0.2);
        }

        .light-mode .tool-card:hover {
            border-color: #0066cc;
            box-shadow: 0 8px 24px rgba(0, 102, 204, 0.15);
        }

        .tool-title {
            font-size: 1.3rem;
            margin-bottom: 10px;
            color: white;
        }

        .light-mode .tool-title {
            color: var(--cynthia-light-text);
        }

        .tool-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .btn-tool {
            padding: 10px 20px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            flex: 1;
        }

        .btn-run {
            background: linear-gradient(135deg, var(--cynthia-success), #00b36b);
            color: white;
        }

        .btn-view {
            background: linear-gradient(135deg, var(--cynthia-primary), #0099cc);
            color: white;
        }

        /* টার্মিনাল */
        .terminal-container {
            background: rgba(0, 0, 0, 0.9);
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid rgba(0, 243, 255, 0.3);
            margin-top: 30px;
        }

        .light-mode .terminal-container {
            background: rgba(0, 0, 0, 0.95);
            border: 1px solid rgba(0, 243, 255, 0.3);
        }

        .terminal-header {
            background: linear-gradient(90deg, #151530, #0a0a1a);
            padding: 15px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(0, 243, 255, 0.2);
        }

        .light-mode .terminal-header {
            background: linear-gradient(90deg, #252540, #1a1a2a);
        }

        .terminal-body {
            padding: 25px;
            min-height: 400px;
            max-height: 600px;
            overflow-y: auto;
            font-family: 'Consolas', monospace;
            background: #000;
        }

        /* মডাল */
        .modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 10000;
            align-items: center;
            justify-content: center;
            padding: 20px;
            transition: background-color 0.3s ease;
        }

        .light-mode .modal {
            background: rgba(0, 0, 0, 0.6);
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: var(--cynthia-dark-light);
            border-radius: 16px;
            border: 1px solid rgba(0, 243, 255, 0.3);
            width: 100%;
            max-width: 500px;
            padding: 30px;
            animation: themeSwitch 0.3s ease;
        }

        .light-mode .modal-content {
            background: var(--cynthia-card-light);
            border: 1px solid rgba(0, 0, 0, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        /* নোটিফিকেশন */
        .notification-area {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10001;
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-width: 400px;
        }

        .notification {
            background: rgba(21, 21, 48, 0.95);
            border: 1px solid rgba(0, 243, 255, 0.3);
            border-radius: 12px;
            padding: 15px;
            backdrop-filter: blur(20px);
            display: flex;
            align-items: center;
            gap: 15px;
            animation: slideIn 0.3s ease;
        }

        .light-mode .notification {
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(0, 0, 0, 0.1);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }

        /* লোডিং */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(0, 243, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--cynthia-primary);
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* লোডিং স্টেট */
        .loading-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 20000;
            flex-direction: column;
            gap: 20px;
        }

        .loading-overlay.active {
            display: flex;
        }

        .loading-text {
            color: var(--cynthia-primary);
            font-size: 1.2rem;
        }

        /* সার্চ ও ফিল্টার */
        .search-filter-container {
            display: flex;
            gap: 15px;
            margin: 30px 0;
            flex-wrap: wrap;
            align-items: center;
        }

        .search-box {
            flex: 1;
            min-width: 200px;
            padding: 12px 20px;
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(0, 243, 255, 0.3);
            border-radius: 8px;
            color: white;
            font-size: 16px;
        }

        .light-mode .search-box {
            background: white;
            border: 1px solid rgba(0, 0, 0, 0.2);
            color: var(--cynthia-light-text);
        }

        .filter-select {
            padding: 12px 20px;
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(0, 243, 255, 0.3);
            border-radius: 8px;
            color: white;
            font-size: 16px;
            min-width: 150px;
        }

        .light-mode .filter-select {
            background: white;
            border: 1px solid rgba(0, 0, 0, 0.2);
            color: var(--cynthia-light-text);
        }

        /* পেজিনেশন */
        .pagination {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 40px 0;
            flex-wrap: wrap;
        }

        .page-btn {
            padding: 8px 16px;
            background: rgba(21, 21, 48, 0.8);
            border: 1px solid rgba(0, 243, 255, 0.3);
            border-radius: 6px;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 40px;
            text-align: center;
        }

        .light-mode .page-btn {
            background: white;
            border: 1px solid rgba(0, 0, 0, 0.1);
            color: var(--cynthia-light-text);
        }

        .page-btn:hover {
            background: rgba(0, 243, 255, 0.2);
            border-color: var(--cynthia-primary);
        }

        .light-mode .page-btn:hover {
            background: rgba(0, 102, 204, 0.1);
            border-color: #0066cc;
        }

        .page-btn.active {
            background: linear-gradient(135deg, var(--cynthia-primary), var(--cynthia-secondary));
            color: white;
            border-color: transparent;
        }

        /* ইতিহাস ট্র্যাকিং */
        .history-section {
            margin: 40px 0;
            padding: 25px;
            background: rgba(21, 21, 48, 0.8);
            border-radius: 12px;
            border: 1px solid rgba(0, 243, 255, 0.1);
        }

        .light-mode .history-section {
            background: var(--cynthia-card-light);
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        /* অ্যাক্সেসিবিলিটি */
        .skip-to-content {
            position: absolute;
            top: -40px;
            left: 10px;
            background: var(--cynthia-primary);
            color: var(--cynthia-dark);
            padding: 10px;
            text-decoration: none;
            border-radius: 6px;
            font-weight: 600;
            z-index: 10001;
        }

        .skip-to-content:focus {
            top: 10px;
        }

        /* অফলাইন ইন্ডিকেটর */
        .offline-indicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--cynthia-warning);
            color: black;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            z-index: 10001;
            display: none;
            animation: slideIn 0.3s ease;
        }

        .offline-indicator.show {
            display: block;
        }

        /* পিডিএফ প্রিন্ট স্টাইল */
        @media print {
            .no-print {
                display: none !important;
            }
            
            .page {
                display: block !important;
                padding: 0;
            }
            
            body {
                background: white !important;
                color: black !important;
            }
            
            .tool-card {
                break-inside: avoid;
                page-break-inside: avoid;
                border: 1px solid #ddd !important;
                background: white !important;
                color: black !important;
            }
        }

        /* রেস্পন্সিভ */
        @media (max-width: 768px) {
            .navbar-content {
                flex-wrap: wrap;
            }
            
            .nav-links {
                order: 3;
                width: 100%;
                justify-content: center;
                margin-top: 15px;
                flex-wrap: wrap;
            }
            
            .tools-grid {
                grid-template-columns: 1fr;
            }
            
            .search-filter-container {
                flex-direction: column;
            }
            
            .search-box, .filter-select {
                width: 100%;
            }
            
            .terminal-body {
                padding: 15px;
                min-height: 300px;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 0 10px;
            }
            
            .tool-actions {
                flex-direction: column;
            }
            
            .btn-tool {
                width: 100%;
            }
        }

        /* এজ কেস: উচ্চ কন্ট্রাস্ট */
        @media (prefers-contrast: high) {
            .nav-link.active {
                outline: 2px solid var(--cynthia-primary);
                outline-offset: 2px;
            }
            
            .btn {
                outline: 2px solid currentColor;
            }
        }

        /* এজ কেস: রিডাক্সড মোশন */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
            
            .tool-card:hover {
                transform: none;
            }
        }
    </style>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- PWA মেটা ট্যাগ -->
    <meta name="theme-color" content="#0a0a1a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="manifest" id="app-manifest">
</head>
<body>
    <!-- অ্যাক্সেসিবিলিটি স্কিপ লিংক -->
    <a href="#main-content" class="skip-to-content" id="skipToContent">
        মূল কন্টেন্টে যান
    </a>

    <!-- লোডিং ওভারলে -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading" style="width: 60px; height: 60px; border-width: 5px;"></div>
        <div class="loading-text" id="loadingText">লোড হচ্ছে...</div>
    </div>

    <!-- অফলাইন ইন্ডিকেটর -->
    <div class="offline-indicator" id="offlineIndicator">
        <i class="fas fa-wifi-slash"></i> আপনি অফলাইনে আছেন
    </div>

    <!-- নোটিফিকেশন এরিয়া -->
    <div class="notification-area" id="notificationArea"></div>

    <!-- লগইন মডাল -->
    <div class="modal" id="loginModal">
        <div class="modal-content">
            <h2 style="color: var(--cynthia-primary); margin-bottom: 25px; display: flex; align-items: center; gap: 10px;">
                <i class="fas fa-lock"></i> এডমিন লগইন
            </h2>
            <div style="margin-bottom: 20px;">
                <label for="adminUsername" style="color: var(--cynthia-accent); margin-bottom: 8px; display: block; font-weight: 600;">
                    <i class="fas fa-user"></i> ইউজারনেম *
                </label>
                <input type="text" id="adminUsername" 
                       style="width: 100%; padding: 12px; background: rgba(0,0,0,0.4); border: 1px solid rgba(0,243,255,0.3); border-radius: 8px; color: white; font-size: 16px;"
                       placeholder="এডমিন ইউজারনেম" required>
                <div class="input-error" id="usernameError" style="color: var(--cynthia-danger); font-size: 0.9rem; margin-top: 5px; display: none;"></div>
            </div>
            <div style="margin-bottom: 25px;">
                <label for="adminPassword" style="color: var(--cynthia-accent); margin-bottom: 8px; display: block; font-weight: 600;">
                    <i class="fas fa-key"></i> পাসওয়ার্ড *
                </label>
                <input type="password" id="adminPassword" 
                       style="width: 100%; padding: 12px; background: rgba(0,0,0,0.4); border: 1px solid rgba(0,243,255,0.3); border-radius: 8px; color: white; font-size: 16px;"
                       placeholder="পাসওয়ার্ড" required>
                <div class="input-error" id="passwordError" style="color: var(--cynthia-danger); font-size: 0.9rem; margin-top: 5px; display: none;"></div>
            </div>
            <button class="btn" id="loginBtn" style="width: 100%;" aria-label="লগইন করুন">
                <i class="fas fa-sign-in-alt"></i> লগইন করুন
            </button>
        </div>
    </div>

    <!-- নেভিগেশন বার -->
    <nav class="navbar" role="navigation" aria-label="মূল নেভিগেশন">
        <div class="container">
            <div class="navbar-content">
                <a href="#home" class="logo" id="homeLogo" aria-label="PowerScript Pro হোম পেজে যান">
                    <i class="fas fa-terminal" aria-hidden="true"></i>
                    <span>PowerScript Pro <sup>v4.0</sup></span>
                </a>
                
                <ul class="nav-links" role="menubar">
                    <li role="none"><a class="nav-link active" data-page="home" role="menuitem" tabindex="0"><i class="fas fa-home"></i> হোম</a></li>
                    <li role="none"><a class="nav-link" data-page="tools" role="menuitem" tabindex="0"><i class="fas fa-tools"></i> টুলস</a></li>
                    <li role="none"><a class="nav-link" data-page="terminal" role="menuitem" tabindex="0"><i class="fas fa-terminal"></i> টার্মিনাল</a></li>
                    <li role="none"><a class="nav-link" data-page="settings" role="menuitem" tabindex="0"><i class="fas fa-cog"></i> সেটিংস</a></li>
                    <li role="none"><button class="theme-toggle" id="themeToggle" aria-label="থিম পরিবর্তন করুন">
                        <i class="fas fa-moon" id="themeIcon"></i>
                    </button></li>
                </ul>
                
                <div class="admin-controls" id="adminControls" style="display: none;">
                    <button class="btn" id="addToolBtn" aria-label="নতুন টুল যোগ করুন">
                        <i class="fas fa-plus"></i> টুল যুক্ত করুন
                    </button>
                    <button class="btn" id="logoutBtn" style="background: linear-gradient(135deg, var(--cynthia-danger), #ff3838); margin-left: 10px;" aria-label="লগআউট করুন">
                        <i class="fas fa-sign-out-alt"></i> লগআউট
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- মেইন কন্টেন্ট -->
    <main class="main-content" id="main-content" role="main">
        <div class="container">
            <!-- হোম পেজ -->
            <div id="homePage" class="page active">
                <h1 style="margin-bottom: 30px; color: var(--cynthia-primary); display: flex; align-items: center; gap: 15px;">
                    <i class="fas fa-rocket"></i> PowerScript Pro ড্যাশবোর্ড
                </h1>
                
                <!-- স্ট্যাটিস্টিক্স -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin: 30px 0;">
                    <div style="background: rgba(21, 21, 48, 0.8); border-radius: 12px; padding: 25px; border-left: 4px solid var(--cynthia-primary);">
                        <div style="font-size: 2.5rem; font-weight: 800; color: var(--cynthia-primary); margin-bottom: 10px;" id="totalTools">0</div>
                        <div style="color: rgba(255,255,255,0.7);">মোট টুলস</div>
                    </div>
                    <div style="background: rgba(21, 21, 48, 0.8); border-radius: 12px; padding: 25px; border-left: 4px solid var(--cynthia-success);">
                        <div style="font-size: 2.5rem; font-weight: 800; color: var(--cynthia-success); margin-bottom: 10px;" id="executionCount">0</div>
                        <div style="color: rgba(255,255,255,0.7);">মোট এক্সিকিউশন</div>
                    </div>
                    <div style="background: rgba(21, 21, 48, 0.8); border-radius: 12px; padding: 25px; border-left: 4px solid var(--cynthia-secondary);">
                        <div style="font-size: 2.5rem; font-weight: 800; color: var(--cynthia-secondary); margin-bottom: 10px;" id="favoriteCount">0</div>
                        <div style="color: rgba(255,255,255,0.7);">ফেভারিট</div>
                    </div>
                </div>
                
                <!-- সার্চ এবং ফিল্টার -->
                <div class="search-filter-container">
                    <input type="text" id="homeSearch" class="search-box" placeholder="টুল খুঁজুন..." aria-label="টুল সার্চ করুন">
                    <select id="homeCategoryFilter" class="filter-select" aria-label="ক্যাটাগরি ফিল্টার করুন">
                        <option value="all">সব ক্যাটাগরি</option>
                        <option value="system">সিস্টেম</option>
                        <option value="network">নেটওয়ার্ক</option>
                        <option value="backup">ব্যাকআপ</option>
                        <option value="security">সিকিউরিটি</option>
                        <option value="automation">অটোমেশন</option>
                    </select>
                    <select id="homeSortBy" class="filter-select" aria-label="সর্ট করুন">
                        <option value="recent">সাম্প্রতিক</option>
                        <option value="popular">জনপ্রিয়</option>
                        <option value="name">নাম (A-Z)</option>
                        <option value="executions">এক্সিকিউশন</option>
                    </select>
                </div>
                
                <!-- রিসেন্ট টুলস -->
                <h2 style="margin: 40px 0 20px 0; color: var(--cynthia-accent); display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-history"></i> সাম্প্রতিক টুলস
                </h2>
                <div class="tools-grid" id="recentTools">
                    <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: rgba(255,255,255,0.5);">
                        <div class="loading" style="margin: 0 auto;"></div>
                        <p style="margin-top: 15px;">টুলস লোড হচ্ছে...</p>
                    </div>
                </div>
                
                <!-- পেজিনেশন -->
                <div class="pagination" id="homePagination" style="display: none;"></div>
            </div>

            <!-- টুলস পেজ -->
            <div id="toolsPage" class="page">
                <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 20px; margin-bottom: 30px;">
                    <h1 style="color: var(--cynthia-primary); display: flex; align-items: center; gap: 15px;">
                        <i class="fas fa-tools"></i> সকল টুলস
                    </h1>
                    <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                        <button class="btn" id="importToolsBtn" aria-label="টুলস ইম্পোর্ট করুন">
                            <i class="fas fa-upload"></i> ইম্পোর্ট
                        </button>
                        <button class="btn" id="exportToolsBtn" aria-label="টুলস এক্সপোর্ট করুন">
                            <i class="fas fa-download"></i> এক্সপোর্ট
                        </button>
                        <button class="btn" id="printToolsBtn" aria-label="টুলস প্রিন্ট করুন" class="no-print">
                            <i class="fas fa-print"></i> প্রিন্ট
                        </button>
                    </div>
                </div>
                
                <!-- সার্চ এবং ফিল্টার -->
                <div class="search-filter-container">
                    <input type="text" id="searchTools" class="search-box" placeholder="টুল খুঁজুন..." aria-label="টুল সার্চ করুন">
                    <select id="categoryFilter" class="filter-select" aria-label="ক্যাটাগরি ফিল্টার করুন">
                        <option value="all">সব ক্যাটাগরি</option>
                        <option value="system">সিস্টেম</option>
                        <option value="network">নেটওয়ার্ক</option>
                        <option value="backup">ব্যাকআপ</option>
                        <option value="security">সিকিউরিটি</option>
                        <option value="automation">অটোমেশন</option>
                    </select>
                    <select id="sortBy" class="filter-select" aria-label="সর্ট করুন">
                        <option value="recent">সাম্প্রতিক</option>
                        <option value="popular">জনপ্রিয়</option>
                        <option value="name">নাম (A-Z)</option>
                        <option value="executions">এক্সিকিউশন</option>
                        <option value="favorites">ফেভারিট</option>
                    </select>
                </div>
                
                <div class="tools-grid" id="allTools">
                    <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: rgba(255,255,255,0.5);">
                        <div class="loading" style="margin: 0 auto;"></div>
                        <p style="margin-top: 15px;">টুলস লোড হচ্ছে...</p>
                    </div>
                </div>
                
                <!-- পেজিনেশন -->
                <div class="pagination" id="toolsPagination"></div>
            </div>

            <!-- টার্মিনাল পেজ -->
            <div id="terminalPage" class="page">
                <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 20px; margin-bottom: 30px;">
                    <h1 style="color: var(--cynthia-primary); display: flex; align-items: center; gap: 15px;">
                        <i class="fas fa-terminal"></i> PowerShell টার্মিনাল
                    </h1>
                    <div style="display: flex; gap: 15px;">
                        <button class="btn" id="clearTerminalBtn" aria-label="টার্মিনাল ক্লিয়ার করুন">
                            <i class="fas fa-broom"></i> ক্লিয়ার করুন
                        </button>
                        <button class="btn" id="sampleCommandBtn" aria-label="স্যাম্পল কমান্ড রান করুন">
                            <i class="fas fa-play"></i> স্যাম্পল রান
                        </button>
                        <button class="btn" id="exportTerminalBtn" aria-label="টার্মিনাল আউটপুট এক্সপোর্ট করুন">
                            <i class="fas fa-download"></i> আউটপুট সেভ
                        </button>
                    </div>
                </div>

                <!-- এক্সিকিউশন ইতিহাস -->
                <div class="history-section">
                    <h3 style="color: var(--cynthia-primary); margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-history"></i> এক্সিকিউশন ইতিহাস
                    </h3>
                    <div id="executionHistory" style="max-height: 150px; overflow-y: auto; font-family: 'Consolas', monospace; font-size: 0.9rem;">
                        <!-- ইতিহাস এখানে লোড হবে -->
                    </div>
                </div>

                <div class="terminal-container">
                    <div class="terminal-header">
                        <h3 style="color: var(--cynthia-primary); display: flex; align-items: center; gap: 10px; font-size: 1.1rem;">
                            <i class="fab fa-windows"></i> PowerShell Terminal v4.0
                            <span id="terminalStatus" style="font-size: 0.8rem; color: #00ff00;">
                                <i class="fas fa-circle" style="animation: blink 1.5s infinite;"></i> অনলাইন
                            </span>
                        </h3>
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div style="color: rgba(255,255,255,0.7); font-size: 0.9rem;">
                                <span id="commandCount">0</span> কমান্ড
                            </div>
                            <button id="toggleTerminalTheme" style="background: transparent; border: none; color: var(--cynthia-primary); cursor: pointer;">
                                <i class="fas fa-adjust"></i>
                            </button>
                        </div>
                    </div>
                    <div class="terminal-body" id="terminalBody">
                        <div id="terminalOutput" style="margin-bottom: 20px;">
                            <div style="color: #00ff00; margin-bottom: 5px;">PowerScript Pro Terminal v4.0</div>
                            <div style="color: #00ff00; margin-bottom: 5px;">টাইপ 'help' কমান্ডের লিস্ট দেখতে</div>
                            <div style="color: #00ff00; margin-bottom: 5px;">টাইপ 'Show-MainMenu' PowerScript Pro মেনু দেখতে</div>
                            <div style="color: rgba(0,255,0,0.5); margin: 15px 0;">-----------------------------</div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span style="color: var(--cynthia-primary); font-weight: bold; font-family: 'Consolas', monospace;">PS&gt;</span>
                            <input type="text" id="terminalInput" 
                                   style="flex: 1; background: transparent; border: none; color: white; font-family: 'Consolas', monospace; font-size: 1rem; outline: none; caret-color: var(--cynthia-primary);"
                                   placeholder="কমান্ড লিখুন (Enter চাপুন)..." 
                                   aria-label="PowerShell কমান্ড লিখুন">
                        </div>
                    </div>
                </div>
            </div>

            <!-- সেটিংস পেজ -->
            <div id="settingsPage" class="page">
                <h1 style="margin-bottom: 30px; color: var(--cynthia-primary); display: flex; align-items: center; gap: 15px;">
                    <i class="fas fa-cog"></i> সিস্টেম সেটিংস
                </h1>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px;">
                    <!-- ইউজার প্রেফারেন্স -->
                    <div style="background: rgba(21, 21, 48, 0.8); border-radius: 12px; padding: 25px; border: 1px solid rgba(0,243,255,0.1);">
                        <h3 style="color: var(--cynthia-primary); margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-user-cog"></i> ইউজার প্রেফারেন্স
                        </h3>
                        <div style="margin-bottom: 20px;">
                            <label style="color: var(--cynthia-accent); display: block; margin-bottom: 10px; font-weight: 600;">ডিফল্ট থিম</label>
                            <select id="defaultTheme" style="width: 100%; padding: 12px; background: rgba(0,0,0,0.4); border: 1px solid rgba(0,243,255,0.3); border-radius: 8px; color: white;">
                                <option value="dark">ডার্ক থিম</option>
                                <option value="light">লাইট থিম</option>
                                <option value="auto">সিস্টেম অনুযায়ী</option>
                            </select>
                        </div>
                        <div style="margin-bottom: 20px;">
                            <label style="color: var(--cynthia-accent); display: block; margin-bottom: 10px; font-weight: 600;">
                                <input type="checkbox" id="autoSave" style="margin-right: 10px;"> অটো সেভ
                            </label>
                            <label style="color: var(--cynthia-accent); display: block; margin-bottom: 10px; font-weight: 600;">
                                <input type="checkbox" id="notifications" style="margin-right: 10px;"> নোটিফিকেশন
                            </label>
                        </div>
                        <button class="btn" id="savePreferencesBtn" style="width: 100%;">
                            <i class="fas fa-save"></i> প্রেফারেন্স সেভ করুন
                        </button>
                    </div>
                    
                    <!-- সিকিউরিটি সেটিংস -->
                    <div style="background: rgba(21, 21, 48, 0.8); border-radius: 12px; padding: 25px; border: 1px solid rgba(0,243,255,0.1);">
                        <h3 style="color: var(--cynthia-primary); margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-user-shield"></i> সিকিউরিটি সেটিংস
                        </h3>
                        <div style="margin-bottom: 20px;">
                            <label style="color: var(--cynthia-accent); display: block; margin-bottom: 10px; font-weight: 600;">সিকিউরিটি লেভেল</label>
                            <select id="securityLevel" style="width: 100%; padding: 12px; background: rgba(0,0,0,0.4); border: 1px solid rgba(0,243,255,0.3); border-radius: 8px; color: white;">
                                <option value="high">হাই (সবচেয়ে নিরাপদ)</option>
                                <option value="medium">মিডিয়াম</option>
                                <option value="low">লো</option>
                            </select>
                        </div>
                        <button class="btn" id="securityScanBtn" style="width: 100%;">
                            <i class="fas fa-shield-alt"></i> সিকিউরিটি স্ক্যান চালান
                        </button>
                    </div>
                    
                    <!-- ডেটা ম্যানেজমেন্ট -->
                    <div style="background: rgba(21, 21, 48, 0.8); border-radius: 12px; padding: 25px; border: 1px solid rgba(0,243,255,0.1);">
                        <h3 style="color: var(--cynthia-primary); margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-database"></i> ডেটা ম্যানেজমেন্ট
                        </h3>
                        <div style="display: flex; flex-direction: column; gap: 10px;">
                            <button class="btn" id="backupDataBtn">
                                <i class="fas fa-save"></i> ডেটা ব্যাকআপ করুন
                            </button>
                            <button class="btn" id="restoreDataBtn">
                                <i class="fas fa-undo"></i> ডেটা রিস্টোর করুন
                            </button>
                            <button class="btn" id="clearDataBtn" style="background: linear-gradient(135deg, var(--cynthia-danger), #ff3838);">
                                <i class="fas fa-trash"></i> সব ডেটা ক্লিয়ার করুন
                            </button>
                        </div>
                    </div>
                    
                    <!-- অ্যাডভান্সড সেটিংস -->
                    <div style="background: rgba(21, 21, 48, 0.8); border-radius: 12px; padding: 25px; border: 1px solid rgba(0,243,255,0.1);">
                        <h3 style="color: var(--cynthia-primary); margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-sliders-h"></i> অ্যাডভান্সড সেটিংস
                        </h3>
                        <div style="margin-bottom: 20px;">
                            <label style="color: var(--cynthia-accent); display: block; margin-bottom: 10px; font-weight: 600;">পেজিনেশন সীমা</label>
                            <input type="number" id="paginationLimit" min="5" max="50" value="12" 
                                   style="width: 100%; padding: 12px; background: rgba(0,0,0,0.4); border: 1px solid rgba(0,243,255,0.3); border-radius: 8px; color: white;">
                        </div>
                        <div style="margin-bottom: 20px;">
                            <label style="color: var(--cynthia-accent); display: block; margin-bottom: 10px; font-weight: 600;">
                                <input type="checkbox" id="offlineMode" style="margin-right: 10px;"> অফলাইন মোড
                            </label>
                        </div>
                        <button class="btn" id="clearCacheBtn" style="width: 100%; background: linear-gradient(135deg, var(--cynthia-warning), #ff7f00);">
                            <i class="fas fa-broom"></i> ক্যাশে ক্লিয়ার করুন
                        </button>
                    </div>
                </div>
                
                <!-- সিস্টেম তথ্য -->
                <div style="margin-top: 40px; background: rgba(21, 21, 48, 0.8); border-radius: 12px; padding: 25px; border: 1px solid rgba(0,243,255,0.1);">
                    <h3 style="color: var(--cynthia-primary); margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-info-circle"></i> সিস্টেম তথ্য
                    </h3>
                    <div id="systemInfo" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; font-family: 'Consolas', monospace; font-size: 0.9rem;">
                        <div><strong>ব্রাউজার:</strong> <span id="browserName">-</span></div>
                        <div><strong>অনলাইন:</strong> <span id="onlineStatus">হ্যাঁ</span></div>
                        <div><strong>স্ক্রীন রেজোলিউশন:</strong> <span id="screenResolution">-</span></div>
                        <div><strong>স্থানীয় সময়:</strong> <span id="localTime">-</span></div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- টুল ম্যানেজমেন্ট মডাল -->
    <div class="modal" id="toolModal">
        <div class="modal-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                <h2 style="color: var(--cynthia-primary); display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-plus-circle"></i> নতুন টুল যুক্ত করুন
                </h2>
                <button id="closeToolModal" style="background: transparent; border: none; color: var(--cynthia-primary); font-size: 1.5rem; cursor: pointer; padding: 5px;" aria-label="মডাল বন্ধ করুন">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <form id="toolForm">
                <div style="margin-bottom: 20px;">
                    <label for="toolName" style="color: var(--cynthia-accent); margin-bottom: 8px; display: block; font-weight: 600;">
                        <i class="fas fa-heading"></i> টুলের নাম *
                    </label>
                    <input type="text" id="toolName" 
                           style="width: 100%; padding: 12px; background: rgba(0,0,0,0.4); border: 1px solid rgba(0,243,255,0.3); border-radius: 8px; color: white; font-size: 16px;"
                           placeholder="টুলের নাম লিখুন" required>
                    <div class="input-error" id="toolNameError" style="color: var(--cynthia-danger); font-size: 0.9rem; margin-top: 5px; display: none;"></div>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label for="toolCategory" style="color: var(--cynthia-accent); margin-bottom: 8px; display: block; font-weight: 600;">
                        <i class="fas fa-tag"></i> ক্যাটাগরি *
                    </label>
                    <select id="toolCategory" style="width: 100%; padding: 12px; background: rgba(0,0,0,0.4); border: 1px solid rgba(0,243,255,0.3); border-radius: 8px; color: white; font-size: 16px;" required>
                        <option value="">ক্যাটাগরি নির্বাচন করুন</option>
                        <option value="system">সিস্টেম</option>
                        <option value="network">নেটওয়ার্ক</option>
                        <option value="backup">ব্যাকআপ</option>
                        <option value="security">সিকিউরিটি</option>
                        <option value="automation">অটোমেশন</option>
                        <option value="utility">ইউটিলিটি</option>
                    </select>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label for="toolDescription" style="color: var(--cynthia-accent); margin-bottom: 8px; display: block; font-weight: 600;">
                        <i class="fas fa-align-left"></i> বিবরণ
                    </label>
                    <textarea id="toolDescription" rows="3"
                           style="width: 100%; padding: 12px; background: rgba(0,0,0,0.4); border: 1px solid rgba(0,243,255,0.3); border-radius: 8px; color: white; font-size: 16px; resize: vertical;"
                           placeholder="টুলের বিস্তারিত বিবরণ লিখুন..."></textarea>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label for="toolCode" style="color: var(--cynthia-accent); margin-bottom: 8px; display: block; font-weight: 600;">
                        <i class="fab fa-windows"></i> PowerShell কোড *
                    </label>
                    <textarea id="toolCode" rows="6"
                           style="width: 100%; padding: 12px; background: rgba(0,0,0,0.8); border: 1px solid rgba(0,243,255,0.3); border-radius: 8px; color: #00ff00; font-family: 'Consolas', monospace; font-size: 14px; resize: vertical;"
                           placeholder="Write-Host 'Hello, PowerShell!'" required></textarea>
                    <div class="input-error" id="toolCodeError" style="color: var(--cynthia-danger); font-size: 0.9rem; margin-top: 5px; display: none;"></div>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 25px;">
                    <button type="submit" class="btn" style="background: linear-gradient(135deg, var(--cynthia-success), #00b36b);">
                        <i class="fas fa-save"></i> সংরক্ষণ করুন
                    </button>
                    <button type="button" id="cancelToolBtn" class="btn" style="background: linear-gradient(135deg, var(--cynthia-danger), #ff3838);">
                        <i class="fas fa-times"></i> বাতিল করুন
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- টুল ডিটেলস মডাল -->
    <div class="modal" id="toolDetailModal">
        <div class="modal-content" style="max-width: 800px;">
            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 25px;">
                <div>
                    <h2 id="detailTitle" style="color: var(--cynthia-primary); margin-bottom: 10px; font-size: 1.8rem;"></h2>
                    <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                        <div id="detailCategory" style="background: rgba(0,243,255,0.15); padding: 8px 16px; border-radius: 20px; font-size: 0.9rem; color: var(--cynthia-primary); display: inline-block;"></div>
                        <div id="detailExecutionCount" style="background: rgba(0,255,157,0.15); padding: 8px 16px; border-radius: 20px; font-size: 0.9rem; color: var(--cynthia-success); display: inline-block;"></div>
                        <button id="toggleFavorite" style="background: transparent; border: none; color: var(--cynthia-accent); font-size: 1.2rem; cursor: pointer; padding: 5px;" aria-label="ফেভারিটে যোগ করুন">
                            <i class="far fa-star"></i>
                        </button>
                    </div>
                </div>
                <button id="closeDetailModal" style="background: transparent; border: none; color: var(--cynthia-primary); font-size: 1.5rem; cursor: pointer; padding: 5px;" aria-label="মডাল বন্ধ করুন">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div id="detailDescription" style="color: rgba(255,255,255,0.8); margin-bottom: 25px; line-height: 1.6;"></div>
            
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h3 style="color: var(--cynthia-accent); display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-code"></i> PowerShell কোড
                </h3>
                <div style="display: flex; gap: 10px;">
                    <button id="shareToolBtn" class="btn" style="padding: 8px 16px; font-size: 0.9rem;">
                        <i class="fas fa-share"></i> শেয়ার
                    </button>
                    <button id="downloadCodeBtn" class="btn" style="padding: 8px 16px; font-size: 0.9rem;">
                        <i class="fas fa-download"></i> ডাউনলোড
                    </button>
                </div>
            </div>
            
            <div id="detailCode" style="background: rgba(0,0,0,0.8); padding: 20px; border-radius: 8px; border: 1px solid rgba(0,243,255,0.2); font-family: 'Consolas', monospace; color: #00ff00; max-height: 300px; overflow-y: auto; margin-bottom: 25px;">
                <div class="loading" style="margin: 20px auto;"></div>
            </div>
            
            <div class="tool-actions" style="display: flex; gap: 15px;">
                <button class="btn-tool btn-run" id="runToolBtn">
                    <i class="fas fa-play"></i> এই টুল রান করুন
                </button>
                <button class="btn-tool btn-view" id="copyCodeBtn">
                    <i class="fas fa-copy"></i> কোড কপি করুন
                </button>
                <button class="btn-tool" id="editToolBtn" style="background: linear-gradient(135deg, var(--cynthia-warning), #ff7f00); color: #000;">
                    <i class="fas fa-edit"></i> এডিট করুন
                </button>
            </div>
        </div>
    </div>

    <!-- ফুটার -->
    <footer style="background: rgba(10, 10, 26, 0.95); border-top: 1px solid rgba(0,243,255,0.2); padding: 20px 0; margin-top: 40px;">
        <div class="container">
            <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 20px;">
                <div style="color: rgba(255,255,255,0.7);">
                    <p><i class="fas fa-code"></i> PowerScript Pro v4.0 | © <span id="currentYear"></span></p>
                    <p style="font-size: 0.9rem; margin-top: 5px;"><span id="appVersion">v4.0</span> | <span id="lastUpdated">আজ</span></p>
                </div>
                <div style="display: flex; gap: 10px;">
                    <button class="btn" id="shareAppBtn" style="padding: 8px 16px; font-size: 0.9rem;">
                        <i class="fas fa-share-alt"></i> শেয়ার
                    </button>
                    <button class="btn" id="subscriptionBtn" style="background: linear-gradient(135deg, var(--cynthia-secondary), var(--cynthia-neon)); padding: 8px 16px; font-size: 0.9rem;">
                        <i class="fas fa-bell"></i> সাবস্ক্রাইব করুন
                    </button>
                </div>
            </div>
        </div>
    </footer>

    <!-- JavaScript -->
    <script>
        // ============================================
        // CORE APPLICATION STATE
        // ============================================
        
        const AppState = {
            isAdmin: localStorage.getItem('powerscript_admin_login') === 'true',
            currentPage: 'home',
            tools: [],
            currentToolId: null,
            notificationCount: 0,
            favorites: JSON.parse(localStorage.getItem('powerscript_favorites') || '[]'),
            preferences: JSON.parse(localStorage.getItem('powerscript_preferences') || JSON.stringify({
                theme: 'dark',
                autoSave: true,
                notifications: true,
                paginationLimit: 12,
                offlineMode: false,
                securityLevel: 'medium'
            })),
            executionHistory: JSON.parse(localStorage.getItem('powerscript_execution_history') || '[]'),
            currentPageNumber: 1,
            itemsPerPage: 12,
            isOnline: navigator.onLine,
            debugMode: localStorage.getItem('powerscript_debug_mode') === 'true'
        };

        // ============================================
        // UTILITY FUNCTIONS
        // ============================================
        
        function showLoading(message = 'লোড হচ্ছে...') {
            const overlay = document.getElementById('loadingOverlay');
            const text = document.getElementById('loadingText');
            if (overlay && text) {
                text.textContent = message;
                overlay.classList.add('active');
            }
        }
        
        function hideLoading() {
            const overlay = document.getElementById('loadingOverlay');
            if (overlay) {
                overlay.classList.remove('active');
            }
        }
        
        function showNotification(message, type = 'info', duration = 3000) {
            const notificationArea = document.getElementById('notificationArea');
            if (!notificationArea) return;
            
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.style.borderColor = getNotificationColor(type);
            notification.setAttribute('role', 'alert');
            notification.setAttribute('aria-live', 'assertive');
            
            const icon = getNotificationIcon(type);
            
            notification.innerHTML = `
                ${icon}
                <div>${message}</div>
            `;
            
            notificationArea.appendChild(notification);
            
            // Auto remove
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease forwards';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.remove();
                    }
                }, 300);
            }, duration);
            
            // Update notification count
            AppState.notificationCount++;
            updateNotificationCount(AppState.notificationCount);
        }
        
        function getNotificationColor(type) {
            const colors = {
                'success': 'rgba(0,255,157,0.3)',
                'error': 'rgba(255,71,87,0.3)',
                'warning': 'rgba(255,165,2,0.3)',
                'info': 'rgba(0,243,255,0.3)'
            };
            return colors[type] || colors.info;
        }
        
        function getNotificationIcon(type) {
            const icons = {
                'success': '<i class="fas fa-check-circle" style="color: #00ff9d;" aria-hidden="true"></i>',
                'error': '<i class="fas fa-exclamation-circle" style="color: #ff4757;" aria-hidden="true"></i>',
                'warning': '<i class="fas fa-exclamation-triangle" style="color: #ffa502;" aria-hidden="true"></i>',
                'info': '<i class="fas fa-info-circle" style="color: #00f3ff;" aria-hidden="true"></i>'
            };
            return icons[type] || icons.info;
        }
        
        function updateNotificationCount(count) {
            const badge = document.getElementById('notificationBadge');
            if (badge) {
                if (count > 0) {
                    badge.textContent = count;
                    badge.style.display = 'flex';
                } else {
                    badge.style.display = 'none';
                }
            }
        }
        
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2, 9);
        }
        
        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        function sanitizeInput(input) {
            if (!input) return '';
            return input.replace(/[<>]/g, function(match) {
                return match === '<' ? '&lt;' : '&gt;';
            });
        }
        
        function validateInput(input, type = 'text') {
            if (type === 'text') {
                return input && input.trim().length > 0;
            } else if (type === 'code') {
                return input && input.trim().length > 10;
            } else if (type === 'url') {
                try {
                    new URL(input);
                    return true;
                } catch {
                    return false;
                }
            }
            return false;
        }
        
        // ============================================
        // THEME MANAGEMENT
        // ============================================
        
        function applyTheme(theme) {
            const body = document.body;
            const themeIcon = document.getElementById('themeIcon');
            
            if (theme === 'light' || (theme === 'auto' && window.matchMedia('(prefers-color-scheme: light)').matches)) {
                body.classList.add('light-mode');
                if (themeIcon) {
                    themeIcon.className = 'fas fa-sun';
                }
            } else {
                body.classList.remove('light-mode');
                if (themeIcon) {
                    themeIcon.className = 'fas fa-moon';
                }
            }
            
            // Update CSS variables for light mode
            if (body.classList.contains('light-mode')) {
                document.documentElement.style.setProperty('--cynthia-primary', '#0066cc');
                document.documentElement.style.setProperty('--cynthia-secondary', '#9d00ff');
                document.documentElement.style.setProperty('--cynthia-accent', '#ff9900');
            } else {
                document.documentElement.style.setProperty('--cynthia-primary', '#00f3ff');
                document.documentElement.style.setProperty('--cynthia-secondary', '#9d00ff');
                document.documentElement.style.setProperty('--cynthia-accent', '#ffd700');
            }
            
            // Save preference
            AppState.preferences.theme = theme;
            localStorage.setItem('powerscript_preferences', JSON.stringify(AppState.preferences));
        }
        
        // ============================================
        // TOOL MANAGEMENT
        // ============================================
        
        function loadTools() {
            showLoading('টুলস লোড হচ্ছে...');
            
            try {
                const savedTools = localStorage.getItem('powerscript_tools');
                AppState.tools = savedTools ? JSON.parse(savedTools) : [];
                
                // Load sample tools if empty
                if (AppState.tools.length === 0) {
                    loadSampleTools();
                    AppState.tools = JSON.parse(localStorage.getItem('powerscript_tools') || '[]');
                }
                
                updateStats();
                displayTools();
                setTimeout(() => {
                    showNotification(`${AppState.tools.length}টি টুল লোড করা হয়েছে`, 'success');
                    hideLoading();
                }, 500);
            } catch (error) {
                console.error('Error loading tools:', error);
                showNotification('টুলস লোড করতে সমস্যা!', 'error');
                hideLoading();
            }
        }
        
        function loadSampleTools() {
            const sampleTools = [
                {
                    id: generateId(),
                    name: 'সিস্টেম ইনফরমেশন সংগ্রহ',
                    category: 'system',
                    description: 'সিস্টেমের সম্পূর্ণ তথ্য সংগ্রহ করে দেখায়',
                    code: `Write-Host "=== সিস্টেম ইনফরমেশন ===" -ForegroundColor Cyan\n$os = Get-CimInstance Win32_OperatingSystem\nWrite-Host "OS: $($os.Caption)" -ForegroundColor Green\nWrite-Host "ভার্সন: $($os.Version)" -ForegroundColor Green\nWrite-Host "আর্কিটেকচার: $($os.OSArchitecture)" -ForegroundColor Green\nWrite-Host "সিস্টেম তথ্য সংগ্রহ সম্পূর্ণ!" -ForegroundColor Green`,
                    executionCount: 0,
                    isFavorite: false,
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                },
                {
                    id: generateId(),
                    name: 'নেটওয়ার্ক ডায়াগনস্টিক্স',
                    category: 'network',
                    description: 'নেটওয়ার্ক সংযোগ এবং ডায়াগনস্টিক্স',
                    code: `Write-Host "=== নেটওয়ার্ক ডায়াগনস্টিক্স ===" -ForegroundColor Cyan\n$ping = Test-Connection -ComputerName "8.8.8.8" -Count 2 -Quiet\nif ($ping) {\n    Write-Host "ইন্টারনেট সংযোগ আছে!" -ForegroundColor Green\n} else {\n    Write-Host "ইন্টারনেট সংযোগ নেই!" -ForegroundColor Red\n}\nWrite-Host "নেটওয়ার্ক টেস্ট সম্পূর্ণ!" -ForegroundColor Green`,
                    executionCount: 0,
                    isFavorite: false,
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                },
                {
                    id: generateId(),
                    name: 'ফাইল ব্যাকআপ সিস্টেম',
                    category: 'backup',
                    description: 'ফাইল স্বয়ংক্রিয় ব্যাকআপ তৈরি করে',
                    code: `Write-Host "=== ফাইল ব্যাকআপ ===" -ForegroundColor Cyan\n$backupFolder = "D:\\Backup\\$(Get-Date -Format 'yyyy-MM-dd-HHmm')"\nNew-Item -ItemType Directory -Path $backupFolder -Force\nWrite-Host "ব্যাকআপ ফোল্ডার তৈরি করা হয়েছে: $backupFolder" -ForegroundColor Yellow\nWrite-Host "ব্যাকআপ প্রক্রিয়া শুরু..." -ForegroundColor Green`,
                    executionCount: 0,
                    isFavorite: false,
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                },
                {
                    id: generateId(),
                    name: 'সিকিউরিটি স্ক্যানার',
                    category: 'security',
                    description: 'সিস্টেমের নিরাপত্তা স্ক্যান করে',
                    code: `Write-Host "=== সিকিউরিটি স্ক্যান ===" -ForegroundColor Cyan\nWrite-Host "ফায়ারওয়াল চেক..." -ForegroundColor Yellow\n$firewall = Get-NetFirewallProfile | Where-Object {$_.Enabled -eq 'True'}\nif ($firewall) {\n    Write-Host "ফায়ারওয়াল সক্রিয় আছে!" -ForegroundColor Green\n} else {\n    Write-Host "ফায়ারওয়াল নিষ্ক্রিয়!" -ForegroundColor Red\n}\nWrite-Host "সিকিউরিটি স্ক্যান সম্পূর্ণ!" -ForegroundColor Green`,
                    executionCount: 0,
                    isFavorite: false,
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                },
                {
                    id: generateId(),
                    name: 'ফাইল অর্গানাইজার',
                    category: 'automation',
                    description: 'ফাইলগুলো ক্যাটাগরি অনুযায়ী সাজায়',
                    code: `Write-Host "=== ফাইল অর্গানাইজার ===" -ForegroundColor Cyan\n$sourcePath = "C:\\Users\\$env:USERNAME\\Downloads"\nWrite-Host "ফাইল অর্গানাইজেশন শুরু: $sourcePath" -ForegroundColor Yellow\nWrite-Host "এই স্ক্রিপ্টটি আপনার ডাউনলোড ফোল্ডারের ফাইলগুলো সাজাবে..." -ForegroundColor Green`,
                    executionCount: 0,
                    isFavorite: false,
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                }
            ];
            
            localStorage.setItem('powerscript_tools', JSON.stringify(sampleTools));
            showNotification('স্যাম্পল টুলস যোগ করা হয়েছে!', 'success');
        }
        
        function saveTool(toolData) {
            try {
                if (!validateInput(toolData.name, 'text')) {
                    showNotification('টুলের নাম প্রয়োজন!', 'warning');
                    return false;
                }
                
                if (!validateInput(toolData.code, 'code')) {
                    showNotification('কোড কমপক্ষে ১০ অক্ষরের হতে হবে!', 'warning');
                    return false;
                }
                
                if (AppState.currentToolId) {
                    // Edit existing tool
                    const index = AppState.tools.findIndex(t => t.id === AppState.currentToolId);
                    if (index !== -1) {
                        AppState.tools[index] = {
                            ...AppState.tools[index],
                            ...toolData,
                            updatedAt: new Date().toISOString()
                        };
                    }
                } else {
                    // Add new tool
                    const newTool = {
                        id: generateId(),
                        ...toolData,
                        executionCount: 0,
                        isFavorite: false,
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    };
                    AppState.tools.unshift(newTool);
                }
                
                localStorage.setItem('powerscript_tools', JSON.stringify(AppState.tools));
                showNotification('টুল সংরক্ষণ করা হয়েছে!', 'success');
                
                closeToolModal();
                updateStats();
                displayTools();
                
                return true;
            } catch (error) {
                console.error('Error saving tool:', error);
                showNotification('টুল সংরক্ষণে সমস্যা!', 'error');
                return false;
            }
        }
        
        function deleteTool(toolId) {
            if (!confirm('আপনি কি নিশ্চিত যে এই টুল মুছতে চান?')) return;
            
            AppState.tools = AppState.tools.filter(tool => tool.id !== toolId);
            localStorage.setItem('powerscript_tools', JSON.stringify(AppState.tools));
            
            // Remove from favorites if present
            AppState.favorites = AppState.favorites.filter(id => id !== toolId);
            localStorage.setItem('powerscript_favorites', JSON.stringify(AppState.favorites));
            
            showNotification('টুল মুছে ফেলা হয়েছে!', 'success');
            updateStats();
            displayTools();
        }
        
        function toggleFavorite(toolId) {
            const index = AppState.favorites.indexOf(toolId);
            const tool = AppState.tools.find(t => t.id === toolId);
            
            if (index === -1) {
                AppState.favorites.push(toolId);
                if (tool) tool.isFavorite = true;
                showNotification('ফেভারিটে যোগ করা হয়েছে!', 'success');
            } else {
                AppState.favorites.splice(index, 1);
                if (tool) tool.isFavorite = false;
                showNotification('ফেভারিট থেকে সরানো হয়েছে!', 'info');
            }
            
            localStorage.setItem('powerscript_favorites', JSON.stringify(AppState.favorites));
            localStorage.setItem('powerscript_tools', JSON.stringify(AppState.tools));
            
            updateStats();
            
            // Update UI if on detail modal
            if (AppState.currentToolId === toolId) {
                const favoriteBtn = document.getElementById('toggleFavorite');
                if (favoriteBtn) {
                    if (AppState.favorites.includes(toolId)) {
                        favoriteBtn.innerHTML = '<i class="fas fa-star"></i>';
                    } else {
                        favoriteBtn.innerHTML = '<i class="far fa-star"></i>';
                    }
                }
            }
            
            if (AppState.currentPage === 'home' || AppState.currentPage === 'tools') {
                displayTools();
            }
        }
        
        function displayTools(pageNumber = 1) {
            const recentToolsContainer = document.getElementById('recentTools');
            const allToolsContainer = document.getElementById('allTools');
            const homePagination = document.getElementById('homePagination');
            const toolsPagination = document.getElementById('toolsPagination');
            
            if (!recentToolsContainer && !allToolsContainer) return;
            
            // Get search and filter values
            const searchTerm = document.getElementById('searchTools')?.value.toLowerCase() || '';
            const categoryFilter = document.getElementById('categoryFilter')?.value || 'all';
            const sortBy = document.getElementById('sortBy')?.value || 'recent';
            const homeSearchTerm = document.getElementById('homeSearch')?.value.toLowerCase() || '';
            const homeCategoryFilter = document.getElementById('homeCategoryFilter')?.value || 'all';
            const homeSortBy = document.getElementById('homeSortBy')?.value || 'recent';
            
            // Filter tools based on search and category
            let filteredTools = [...AppState.tools];
            
            if (AppState.currentPage === 'home') {
                if (homeSearchTerm) {
                    filteredTools = filteredTools.filter(tool => 
                        tool.name.toLowerCase().includes(homeSearchTerm) ||
                        tool.description.toLowerCase().includes(homeSearchTerm) ||
                        (tool.category && tool.category.toLowerCase().includes(homeSearchTerm))
                    );
                }
                
                if (homeCategoryFilter !== 'all') {
                    filteredTools = filteredTools.filter(tool => tool.category === homeCategoryFilter);
                }
                
                // Sort tools
                filteredTools.sort(getSortFunction(homeSortBy));
            } else if (AppState.currentPage === 'tools') {
                if (searchTerm) {
                    filteredTools = filteredTools.filter(tool => 
                        tool.name.toLowerCase().includes(searchTerm) ||
                        tool.description.toLowerCase().includes(searchTerm) ||
                        (tool.category && tool.category.toLowerCase().includes(searchTerm))
                    );
                }
                
                if (categoryFilter !== 'all') {
                    filteredTools = filteredTools.filter(tool => tool.category === categoryFilter);
                }
                
                // Sort tools
                filteredTools.sort(getSortFunction(sortBy));
            }
            
            // Calculate pagination
            const totalPages = Math.ceil(filteredTools.length / AppState.itemsPerPage);
            const startIndex = (pageNumber - 1) * AppState.itemsPerPage;
            const endIndex = startIndex + AppState.itemsPerPage;
            const paginatedTools = filteredTools.slice(startIndex, endIndex);
            
            // Recent tools (last 6)
            if (recentToolsContainer) {
                const recentTools = [...AppState.tools].sort((a, b) => 
                    new Date(b.updatedAt || b.createdAt) - new Date(a.updatedAt || a.createdAt)
                ).slice(0, 6);
                
                if (recentTools.length === 0) {
                    recentToolsContainer.innerHTML = `
                        <div style="grid-column: 1 / -1; text-align: center; padding: 60px; color: rgba(255,255,255,0.5);">
                            <i class="fas fa-tools" style="font-size: 4rem; margin-bottom: 20px; opacity: 0.3;"></i>
                            <h3 style="margin-bottom: 15px;">কোন টুল পাওয়া যায়নি</h3>
                            <p style="margin-bottom: 25px;">প্রথম টুল যোগ করতে উপরের বাটন ক্লিক করুন</p>
                            <button class="btn" onclick="openToolModal()">
                                <i class="fas fa-plus"></i> প্রথম টুল যোগ করুন
                            </button>
                        </div>
                    `;
                    homePagination.style.display = 'none';
                } else {
                    recentToolsContainer.innerHTML = paginatedTools.map(tool => createToolCard(tool)).join('');
                    
                    // Show pagination if needed
                    if (totalPages > 1) {
                        homePagination.style.display = 'flex';
                        homePagination.innerHTML = createPagination(pageNumber, totalPages, 'home');
                    } else {
                        homePagination.style.display = 'none';
                    }
                }
            }
            
            // All tools
            if (allToolsContainer) {
                if (paginatedTools.length === 0) {
                    allToolsContainer.innerHTML = `
                        <div style="grid-column: 1 / -1; text-align: center; padding: 60px; color: rgba(255,255,255,0.5);">
                            <i class="fas fa-search" style="font-size: 4rem; margin-bottom: 20px; opacity: 0.3;"></i>
                            <h3 style="margin-bottom: 15px;">কোন টুল পাওয়া যায়নি</h3>
                            <p>আপনার সার্চের সাথে মিলে এমন কোনো টুল নেই</p>
                        </div>
                    `;
                    toolsPagination.style.display = 'none';
                } else {
                    allToolsContainer.innerHTML = paginatedTools.map(tool => createToolCard(tool, true)).join('');
                    
                    // Show pagination
                    toolsPagination.style.display = 'flex';
                    toolsPagination.innerHTML = createPagination(pageNumber, totalPages, 'tools');
                }
            }
        }
        
        function getSortFunction(sortBy) {
            switch(sortBy) {
                case 'popular':
                    return (a, b) => (b.executionCount || 0) - (a.executionCount || 0);
                case 'name':
                    return (a, b) => a.name.localeCompare(b.name);
                case 'executions':
                    return (a, b) => (b.executionCount || 0) - (a.executionCount || 0);
                case 'favorites':
                    return (a, b) => {
                        const aFav = AppState.favorites.includes(a.id) ? 1 : 0;
                        const bFav = AppState.favorites.includes(b.id) ? 1 : 0;
                        return bFav - aFav;
                    };
                case 'recent':
                default:
                    return (a, b) => new Date(b.updatedAt || b.createdAt) - new Date(a.updatedAt || a.createdAt);
            }
        }
        
        function createPagination(currentPage, totalPages, type) {
            let paginationHtml = '';
            
            // Previous button
            if (currentPage > 1) {
                paginationHtml += `
                    <button class="page-btn" onclick="goToPage(${currentPage - 1}, '${type}')" aria-label="পূর্ববর্তী পৃষ্ঠা">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                `;
            }
            
            // Page numbers
            const maxVisiblePages = 5;
            let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
            let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);
            
            if (endPage - startPage + 1 < maxVisiblePages) {
                startPage = Math.max(1, endPage - maxVisiblePages + 1);
            }
            
            for (let i = startPage; i <= endPage; i++) {
                paginationHtml += `
                    <button class="page-btn ${i === currentPage ? 'active' : ''}" onclick="goToPage(${i}, '${type}')" aria-label="পৃষ্ঠা ${i}" aria-current="${i === currentPage ? 'page' : 'false'}">
                        ${i}
                    </button>
                `;
            }
            
            // Next button
            if (currentPage < totalPages) {
                paginationHtml += `
                    <button class="page-btn" onclick="goToPage(${currentPage + 1}, '${type}')" aria-label="পরবর্তী পৃষ্ঠা">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                `;
            }
            
            return paginationHtml;
        }
        
        function goToPage(pageNumber, type) {
            AppState.currentPageNumber = pageNumber;
            displayTools(pageNumber);
            
            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        function createToolCard(tool, showEdit = false) {
            const isFavorite = AppState.favorites.includes(tool.id);
            
            return `
                <div class="tool-card" data-id="${tool.id}" role="article" aria-labelledby="tool-title-${tool.id}">
                    <h3 class="tool-title" id="tool-title-${tool.id}">${escapeHtml(tool.name)}</h3>
                    <p style="color: rgba(255,255,255,0.7); margin-bottom: 15px;">${escapeHtml(tool.description || '')}</p>
                    <div style="display: flex; gap: 8px; margin-bottom: 15px; flex-wrap: wrap;">
                        <span style="background: rgba(0,243,255,0.15); padding: 4px 12px; border-radius: 20px; font-size: 0.8rem; color: var(--cynthia-primary);">
                            ${tool.category || 'general'}
                        </span>
                        <span style="background: rgba(0,255,157,0.15); padding: 4px 12px; border-radius: 20px; font-size: 0.8rem; color: var(--cynthia-success);">
                            ${tool.executionCount || 0} বার রান
                        </span>
                        <button onclick="toggleFavorite('${tool.id}')" style="background: transparent; border: none; color: ${isFavorite ? 'var(--cynthia-accent)' : 'rgba(255,255,255,0.5)'}; cursor: pointer; padding: 4px 8px;" aria-label="${isFavorite ? 'ফেভারিট থেকে সরান' : 'ফেভারিটে যোগ করুন'}">
                            <i class="${isFavorite ? 'fas' : 'far'} fa-star"></i>
                        </button>
                    </div>
                    <div class="tool-actions">
                        <button class="btn-tool btn-run" onclick="runTool('${tool.id}')" aria-label="${tool.name} রান করুন">
                            <i class="fas fa-play"></i> রান করুন
                        </button>
                        <button class="btn-tool btn-view" onclick="viewTool('${tool.id}')" aria-label="${tool.name} বিস্তারিত দেখুন">
                            <i class="fas fa-eye"></i> বিস্তারিত
                        </button>
                        ${AppState.isAdmin && showEdit ? `
                        <button class="btn-tool" onclick="editTool('${tool.id}')" style="background: linear-gradient(135deg, var(--cynthia-warning), #ff7f00); color: #000;" aria-label="${tool.name} এডিট করুন">
                            <i class="fas fa-edit"></i> এডিট
                        </button>
                        ` : ''}
                    </div>
                </div>
            `;
        }
        
        function updateStats() {
            const totalTools = document.getElementById('totalTools');
            const executionCount = document.getElementById('executionCount');
            const favoriteCount = document.getElementById('favoriteCount');
            
            if (totalTools) {
                totalTools.textContent = AppState.tools.length;
            }
            
            if (executionCount) {
                const totalExecutions = AppState.tools.reduce((sum, tool) => sum + (tool.executionCount || 0), 0);
                executionCount.textContent = totalExecutions;
            }
            
            if (favoriteCount) {
                favoriteCount.textContent = AppState.favorites.length;
            }
        }
        
        // ============================================
        // PAGE MANAGEMENT
        // ============================================
        
        function showPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // Update nav links
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            
            // Show selected page
            const page = document.getElementById(pageId + 'Page');
            if (page) {
                page.classList.add('active');
                const navLink = document.querySelector(`[data-page="${pageId}"]`);
                if (navLink) navLink.classList.add('active');
                
                AppState.currentPage = pageId;
                AppState.currentPageNumber = 1;
                
                // Load page content
                if (pageId === 'home' || pageId === 'tools') {
                    displayTools();
                } else if (pageId === 'terminal') {
                    setTimeout(() => {
                        const terminalInput = document.getElementById('terminalInput');
                        if (terminalInput) terminalInput.focus();
                    }, 100);
                } else if (pageId === 'settings') {
                    loadSystemInfo();
                    loadPreferences();
                }
            }
        }
        
        // ============================================
        // TOOL OPERATIONS
        // ============================================
        
        function runTool(toolId) {
            const tool = AppState.tools.find(t => t.id === toolId);
            if (!tool) {
                showNotification('টুল পাওয়া যায়নি!', 'error');
                return;
            }
            
            // Switch to terminal page
            showPage('terminal');
            
            // Execute tool code in terminal
            setTimeout(() => {
                const terminalInput = document.getElementById('terminalInput');
                if (terminalInput) {
                    terminalInput.value = tool.code;
                    executeTerminalCommand();
                }
                
                // Update execution count
                tool.executionCount = (tool.executionCount || 0) + 1;
                tool.lastExecuted = new Date().toISOString();
                localStorage.setItem('powerscript_tools', JSON.stringify(AppState.tools));
                
                // Add to execution history
                AppState.executionHistory.unshift({
                    toolId: toolId,
                    toolName: tool.name,
                    timestamp: new Date().toISOString(),
                    command: tool.code.substring(0, 100) + (tool.code.length > 100 ? '...' : '')
                });
                
                // Keep only last 50 executions
                if (AppState.executionHistory.length > 50) {
                    AppState.executionHistory.pop();
                }
                
                localStorage.setItem('powerscript_execution_history', JSON.stringify(AppState.executionHistory));
                updateExecutionHistory();
                
                updateStats();
                if (AppState.currentPage === 'home' || AppState.currentPage === 'tools') {
                    displayTools();
                }
                
                showNotification(`"${tool.name}" টুল রান করা হয়েছে!`, 'success');
            }, 300);
        }
        
        function viewTool(toolId) {
            const tool = AppState.tools.find(t => t.id === toolId);
            if (!tool) {
                showNotification('টুল পাওয়া যায়নি!', 'error');
                return;
            }
            
            // Set tool details
            document.getElementById('detailTitle').textContent = tool.name;
            document.getElementById('detailCategory').textContent = tool.category || 'general';
            document.getElementById('detailDescription').textContent = tool.description || '';
            document.getElementById('detailExecutionCount').textContent = `${tool.executionCount || 0} বার রান`;
            
            // Format code
            const codeContainer = document.getElementById('detailCode');
            if (codeContainer) {
                const lines = tool.code.split('\n');
                codeContainer.innerHTML = lines.map((line, index) => `
                    <div style="margin-bottom: 2px; font-family: 'Consolas', monospace;">
                        <span style="color: var(--cynthia-secondary); min-width: 40px; display: inline-block; opacity: 0.7;">${index + 1}</span>
                        <span style="color: #00ff00;">${escapeHtml(line)}</span>
                    </div>
                `).join('');
            }
            
            // Update favorite button
            const favoriteBtn = document.getElementById('toggleFavorite');
            if (favoriteBtn) {
                if (AppState.favorites.includes(toolId)) {
                    favoriteBtn.innerHTML = '<i class="fas fa-star"></i>';
                    favoriteBtn.setAttribute('aria-label', 'ফেভারিট থেকে সরান');
                } else {
                    favoriteBtn.innerHTML = '<i class="far fa-star"></i>';
                    favoriteBtn.setAttribute('aria-label', 'ফেভারিটে যোগ করুন');
                }
                favoriteBtn.onclick = () => toggleFavorite(toolId);
            }
            
            // Update edit button visibility
            const editBtn = document.getElementById('editToolBtn');
            if (editBtn) {
                editBtn.style.display = AppState.isAdmin ? 'block' : 'none';
                editBtn.onclick = () => editTool(toolId);
            }
            
            // Store current tool ID
            AppState.currentToolId = toolId;
            
            // Show modal
            const modal = document.getElementById('toolDetailModal');
            if (modal) {
                modal.classList.add('show');
            }
        }
        
        function editTool(toolId) {
            const tool = AppState.tools.find(t => t.id === toolId);
            if (!tool) {
                showNotification('টুল পাওয়া যায়নি!', 'error');
                return;
            }
            
            if (!AppState.isAdmin) {
                showNotification('শুধুমাত্র এডমিন টুল এডিট করতে পারেন!', 'warning');
                return;
            }
            
            // Fill form with tool data
            document.getElementById('toolName').value = tool.name;
            document.getElementById('toolDescription').value = tool.description || '';
            document.getElementById('toolCode').value = tool.code;
            document.getElementById('toolCategory').value = tool.category || 'system';
            
            // Set current tool ID for editing
            AppState.currentToolId = toolId;
            
            // Update modal title
            const modalTitle = document.querySelector('#toolModal h2');
            if (modalTitle) {
                modalTitle.innerHTML = '<i class="fas fa-edit"></i> টুল এডিট করুন';
            }
            
            // Show modal
            const modal = document.getElementById('toolModal');
            if (modal) {
                modal.classList.add('show');
            }
        }
        
        function openToolModal() {
            if (!AppState.isAdmin) {
                showNotification('শুধুমাত্র এডমিন টুল যুক্ত করতে পারেন!', 'warning');
                showLoginModal();
                return;
            }
            
            // Reset form
            document.getElementById('toolForm').reset();
            AppState.currentToolId = null;
            
            // Reset modal title
            const modalTitle = document.querySelector('#toolModal h2');
            if (modalTitle) {
                modalTitle.innerHTML = '<i class="fas fa-plus-circle"></i> নতুন টুল যুক্ত করুন';
            }
            
            // Show modal
            const modal = document.getElementById('toolModal');
            if (modal) {
                modal.classList.add('show');
            }
        }
        
        function closeToolModal() {
            const modal = document.getElementById('toolModal');
            if (modal) {
                modal.classList.remove('show');
            }
            document.getElementById('toolForm').reset();
            AppState.currentToolId = null;
        }
        
        function closeDetailModal() {
            const modal = document.getElementById('toolDetailModal');
            if (modal) {
                modal.classList.remove('show');
            }
            AppState.currentToolId = null;
        }
        
        function downloadToolCode() {
            const tool = AppState.tools.find(t => t.id === AppState.currentToolId);
            if (!tool || !tool.code) return;
            
            try {
                const blob = new Blob([tool.code], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${tool.name.replace(/[^a-z0-9]/gi, '_')}.ps1`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showNotification('কোড ডাউনলোড করা হয়েছে!', 'success');
            } catch (error) {
                showNotification('ডাউনলোড করতে সমস্যা!', 'error');
            }
        }
        
        function shareTool() {
            const tool = AppState.tools.find(t => t.id === AppState.currentToolId);
            if (!tool) return;
            
            if (navigator.share) {
                navigator.share({
                    title: tool.name,
                    text: tool.description,
                    url: window.location.href + '#tool=' + tool.id
                }).then(() => {
                    showNotification('টুল শেয়ার করা হয়েছে!', 'success');
                }).catch(() => {
                    copyShareLink();
                });
            } else {
                copyShareLink();
            }
        }
        
        function copyShareLink() {
            const tool = AppState.tools.find(t => t.id === AppState.currentToolId);
            if (!tool) return;
            
            const shareLink = window.location.origin + window.location.pathname + '#tool=' + tool.id;
            
            navigator.clipboard.writeText(shareLink).then(() => {
                showNotification('শেয়ার লিংক কপি করা হয়েছে!', 'success');
            }).catch(() => {
                // Fallback
                const textArea = document.createElement('textarea');
                textArea.value = shareLink;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showNotification('শেয়ার লিংক কপি করা হয়েছে!', 'success');
            });
        }
        
        // ============================================
        // TERMINAL FUNCTIONS
        // ============================================
        
        function executeTerminalCommand() {
            const input = document.getElementById('terminalInput');
            const outputArea = document.getElementById('terminalOutput');
            
            if (!input || !outputArea) return;
            
            const command = input.value.trim();
            if (!command) return;
            
            // Add command to output
            const commandLine = document.createElement('div');
            commandLine.style.color = 'var(--cynthia-primary)';
            commandLine.textContent = `PS> ${command}`;
            outputArea.appendChild(commandLine);
            
            // Execute command
            let result = '';
            const cmd = command.toLowerCase();
            
            if (cmd === 'help' || cmd === 'সাহায্য') {
                result = `উপলব্ধ কমান্ডস:\n• help/সাহায্য - সাহায্য বার্তা\n• clear/cls - টার্মিনাল ক্লিয়ার\n• tools - টুলস পরিসংখ্যান\n• systeminfo - সিস্টেম তথ্য\n• netdiag - নেটওয়ার্ক ডায়াগনস্টিক্স\n• history - এক্সিকিউশন ইতিহাস\n• date/time - বর্তমান তারিখ/সময়\n• theme [dark/light] - থিম পরিবর্তন`;
            } else if (cmd === 'clear' || cmd === 'cls') {
                setTimeout(() => {
                    outputArea.innerHTML = `
                        <div style="color: #00ff00;">PowerScript Pro Terminal v4.0</div>
                        <div style="color: #00ff00;">টাইপ 'help' কমান্ডের লিস্ট দেখতে</div>
                        <div style="color: rgba(0,255,0,0.5); margin: 15px 0;">-----------------------------</div>
                    `;
                }, 100);
                input.value = '';
                return;
            } else if (cmd === 'tools' || cmd === 'টুলস') {
                result = `টুলস পরিসংখ্যান:\n• মোট টুলস: ${AppState.tools.length}\n• মোট এক্সিকিউশন: ${AppState.tools.reduce((sum, t) => sum + (t.executionCount || 0), 0)}\n• ফেভারিট: ${AppState.favorites.length}\n• সাম্প্রতিক: ${AppState.tools.slice(0, 3).map(t => t.name).join(', ')}`;
            } else if (cmd === 'systeminfo' || cmd === 'সিস্টেমতথ্য') {
                result = `=== সিস্টেম ইনফরমেশন ===\nOS: ${navigator.platform}\nBrowser: ${navigator.userAgent.split(' ')[0]}\nScreen: ${window.screen.width}x${window.screen.height}\nTime: ${new Date().toLocaleTimeString()}\nOnline: ${AppState.isOnline ? 'Yes' : 'No'}\nVersion: PowerScript Pro v4.0`;
            } else if (cmd === 'netdiag' || cmd === 'নেটওয়ার্ক') {
                result = `=== নেটওয়ার্ক ডায়াগনস্টিক্স ===\nঅবস্থা: ${AppState.isOnline ? 'অনলাইন' : 'অফলাইন'}\nIP: সিমুলেটেড\nPing: ${AppState.isOnline ? '45ms' : 'N/A'}\nDNS: ${AppState.isOnline ? 'কাজ করছে' : 'বন্ধ'}\nRecommendation: ${AppState.isOnline ? 'সবকিছু ঠিক আছে!' : 'ইন্টারনেট সংযোগ চেক করুন'}`;
            } else if (cmd === 'history' || cmd === 'ইতিহাস') {
                if (AppState.executionHistory.length === 0) {
                    result = 'কোনো এক্সিকিউশন ইতিহাস নেই।';
                } else {
                    result = '=== এক্সিকিউশন ইতিহাস ===\n' + 
                        AppState.executionHistory.slice(0, 10).map((item, index) => 
                            `${index + 1}. ${item.toolName} - ${new Date(item.timestamp).toLocaleTimeString()}`
                        ).join('\n');
                }
            } else if (cmd === 'date' || cmd === 'time' || cmd === 'তারিখ' || cmd === 'সময়') {
                const now = new Date();
                result = `বর্তমান তারিখ/সময়:\nতারিখ: ${now.toLocaleDateString('bn-BD')}\nসময়: ${now.toLocaleTimeString('bn-BD')}\nদিন: ${now.toLocaleDateString('bn-BD', { weekday: 'long' })}`;
            } else if (cmd.startsWith('theme')) {
                const theme = cmd.split(' ')[1];
                if (theme === 'dark' || theme === 'light') {
                    applyTheme(theme);
                    result = `থিম পরিবর্তন করা হয়েছে: ${theme}`;
                } else {
                    result = 'ব্যবহার: theme [dark/light]';
                }
            } else {
                // Simulate PowerShell execution
                const lines = command.split('\n').length;
                result = `কমান্ড এক্সিকিউট করা হয়েছে: ${command.substring(0, 50)}${command.length > 50 ? '...' : ''}\nসারি সংখ্যা: ${lines}\nস্থিতি: সফল\n(সিমুলেশন মোড - অ্যাকটুয়াল PowerShell নয়)`;
            }
            
            // Add result to output
            const resultLines = result.split('\n');
            resultLines.forEach(line => {
                const resultLine = document.createElement('div');
                resultLine.style.color = '#00ff00';
                resultLine.textContent = line;
                outputArea.appendChild(resultLine);
            });
            
            // Add separator
            const separator = document.createElement('div');
            separator.style.color = 'rgba(0,255,0,0.5)';
            separator.textContent = '-----------------------------';
            outputArea.appendChild(separator);
            
            // Clear input and scroll
            input.value = '';
            const terminalBody = document.getElementById('terminalBody');
            if (terminalBody) {
                terminalBody.scrollTop = terminalBody.scrollHeight;
            }
            
            // Update command count
            const commandCount = document.getElementById('commandCount');
            if (commandCount) {
                const currentCount = parseInt(commandCount.textContent) || 0;
                commandCount.textContent = currentCount + 1;
            }
            
            // Focus input
            input.focus();
        }
        
        function clearTerminal() {
            const outputArea = document.getElementById('terminalOutput');
            if (outputArea) {
                outputArea.innerHTML = `
                    <div style="color: #00ff00;">PowerScript Pro Terminal v4.0</div>
                    <div style="color: #00ff00;">টাইপ 'help' কমান্ডের লিস্ট দেখতে</div>
                    <div style="color: rgba(0,255,0,0.5); margin: 15px 0;">-----------------------------</div>
                `;
                showNotification('টার্মিনাল ক্লিয়ার করা হয়েছে', 'info');
            }
        }
        
        function runSampleCommand() {
            const terminalInput = document.getElementById('terminalInput');
            if (terminalInput) {
                terminalInput.value = 'systeminfo';
                executeTerminalCommand();
            }
        }
        
        function exportTerminalOutput() {
            const outputArea = document.getElementById('terminalOutput');
            if (!outputArea) return;
            
            try {
                const blob = new Blob([outputArea.textContent], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `powerscript-terminal-${new Date().toISOString().split('T')[0]}.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showNotification('টার্মিনাল আউটপুট এক্সপোর্ট করা হয়েছে!', 'success');
            } catch (error) {
                showNotification('এক্সপোর্ট করতে সমস্যা!', 'error');
            }
        }
        
        function updateExecutionHistory() {
            const historyContainer = document.getElementById('executionHistory');
            if (!historyContainer) return;
            
            if (AppState.executionHistory.length === 0) {
                historyContainer.innerHTML = '<div style="color: rgba(255,255,255,0.5); text-align: center; padding: 20px;">কোনো এক্সিকিউশন ইতিহাস নেই</div>';
                return;
            }
            
            historyContainer.innerHTML = AppState.executionHistory.slice(0, 10).map(item => `
                <div style="border-bottom: 1px solid rgba(255,255,255,0.1); padding: 8px 0; display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <div style="color: var(--cynthia-primary); font-weight: 600;">${escapeHtml(item.toolName)}</div>
                        <div style="color: rgba(255,255,255,0.7); font-size: 0.8rem;">${new Date(item.timestamp).toLocaleString('bn-BD')}</div>
                    </div>
                    <button onclick="runTool('${item.toolId}')" style="background: rgba(0,243,255,0.1); border: 1px solid rgba(0,243,255,0.3); color: var(--cynthia-primary); padding: 4px 12px; border-radius: 4px; cursor: pointer; font-size: 0.8rem;">
                        আবার রান
                    </button>
                </div>
            `).join('');
        }
        
        // ============================================
        // AUTHENTICATION
        // ============================================
        
        function checkLogin() {
            const adminControls = document.getElementById('adminControls');
            if (adminControls) {
                adminControls.style.display = AppState.isAdmin ? 'flex' : 'none';
            }
            
            // Show login modal if not logged in
            if (!AppState.isAdmin) {
                setTimeout(() => {
                    showLoginModal();
                }, 500);
            }
        }
        
        function showLoginModal() {
            const modal = document.getElementById('loginModal');
            if (modal) {
                modal.classList.add('show');
                setTimeout(() => {
                    const usernameInput = document.getElementById('adminUsername');
                    if (usernameInput) usernameInput.focus();
                }, 100);
            }
        }
        
        function hideLoginModal() {
            const modal = document.getElementById('loginModal');
            if (modal) {
                modal.classList.remove('show');
            }
        }
        
        function handleLogin() {
            const username = document.getElementById('adminUsername').value.trim();
            const password = document.getElementById('adminPassword').value.trim();
            
            // Clear previous errors
            document.getElementById('usernameError').style.display = 'none';
            document.getElementById('passwordError').style.display = 'none';
            
            let hasError = false;
            
            if (!username) {
                document.getElementById('usernameError').textContent = 'ইউজারনেম প্রয়োজন';
                document.getElementById('usernameError').style.display = 'block';
                hasError = true;
            }
            
            if (!password) {
                document.getElementById('passwordError').textContent = 'পাসওয়ার্ড প্রয়োজন';
                document.getElementById('passwordError').style.display = 'block';
                hasError = true;
            }
            
            if (hasError) return;
            
            // Demo login - in production, use proper authentication
            if (username === 'admin' && password === 'BangLAGG2024') {
                AppState.isAdmin = true;
                localStorage.setItem('powerscript_admin_login', 'true');
                
                const adminControls = document.getElementById('adminControls');
                if (adminControls) adminControls.style.display = 'flex';
                
                hideLoginModal();
                showNotification('সফলভাবে লগইন করা হয়েছে!', 'success');
                
                // Refresh tools display to show edit buttons
                displayTools();
            } else {
                showNotification('ভুল ইউজারনেম বা পাসওয়ার্ড!', 'error');
            }
        }
        
        function logout() {
            AppState.isAdmin = false;
            localStorage.removeItem('powerscript_admin_login');
            
            const adminControls = document.getElementById('adminControls');
            if (adminControls) adminControls.style.display = 'none';
            
            showNotification('সফলভাবে লগআউট করা হয়েছে', 'success');
            showLoginModal();
            
            // Refresh tools display to hide edit buttons
            displayTools();
        }
        
        // ============================================
        // SETTINGS FUNCTIONS
        // ============================================
        
        function loadPreferences() {
            const defaultTheme = document.getElementById('defaultTheme');
            const autoSave = document.getElementById('autoSave');
            const notifications = document.getElementById('notifications');
            const paginationLimit = document.getElementById('paginationLimit');
            const offlineMode = document.getElementById('offlineMode');
            const securityLevel = document.getElementById('securityLevel');
            
            if (defaultTheme) defaultTheme.value = AppState.preferences.theme;
            if (autoSave) autoSave.checked = AppState.preferences.autoSave;
            if (notifications) notifications.checked = AppState.preferences.notifications;
            if (paginationLimit) paginationLimit.value = AppState.preferences.paginationLimit;
            if (offlineMode) offlineMode.checked = AppState.preferences.offlineMode;
            if (securityLevel) securityLevel.value = AppState.preferences.securityLevel;
            
            // Update items per page
            AppState.itemsPerPage = AppState.preferences.paginationLimit || 12;
        }
        
        function savePreferences() {
            AppState.preferences = {
                theme: document.getElementById('defaultTheme').value,
                autoSave: document.getElementById('autoSave').checked,
                notifications: document.getElementById('notifications').checked,
                paginationLimit: parseInt(document.getElementById('paginationLimit').value) || 12,
                offlineMode: document.getElementById('offlineMode').checked,
                securityLevel: document.getElementById('securityLevel').value
            };
            
            localStorage.setItem('powerscript_preferences', JSON.stringify(AppState.preferences));
            
            // Apply theme
            applyTheme(AppState.preferences.theme);
            
            // Update items per page
            AppState.itemsPerPage = AppState.preferences.paginationLimit;
            
            showNotification('প্রেফারেন্স সংরক্ষণ করা হয়েছে!', 'success');
        }
        
        function loadSystemInfo() {
            const browserName = document.getElementById('browserName');
            const onlineStatus = document.getElementById('onlineStatus');
            const screenResolution = document.getElementById('screenResolution');
            const localTime = document.getElementById('localTime');
            
            if (browserName) {
                const ua = navigator.userAgent;
                let browser = 'Unknown';
                
                if (ua.indexOf('Firefox') > -1) browser = 'Firefox';
                else if (ua.indexOf('Chrome') > -1) browser = 'Chrome';
                else if (ua.indexOf('Safari') > -1) browser = 'Safari';
                else if (ua.indexOf('Edge') > -1) browser = 'Edge';
                else if (ua.indexOf('Opera') > -1) browser = 'Opera';
                else if (ua.indexOf('Trident') > -1) browser = 'IE';
                
                browserName.textContent = browser;
            }
            
            if (onlineStatus) {
                onlineStatus.textContent = AppState.isOnline ? 'হ্যাঁ' : 'না';
            }
            
            if (screenResolution) {
                screenResolution.textContent = `${window.screen.width} × ${window.screen.height}`;
            }
            
            if (localTime) {
                localTime.textContent = new Date().toLocaleTimeString('bn-BD');
                // Update time every minute
                setInterval(() => {
                    localTime.textContent = new Date().toLocaleTimeString('bn-BD');
                }, 60000);
            }
        }
        
        function runSecurityScan() {
            showNotification('সিকিউরিটি স্ক্যান শুরু করা হয়েছে...', 'info');
            showLoading('সিকিউরিটি স্ক্যান চলছে...');
            
            setTimeout(() => {
                let score = 100;
                let issues = [];
                let recommendations = [];
                
                if (!AppState.isAdmin) {
                    issues.push('এডমিন লগইন নেই');
                    score -= 30;
                    recommendations.push('এডমিন অ্যাকাউন্টে লগইন করুন');
                }
                
                if (AppState.tools.length === 0) {
                    issues.push('কোন টুল নেই');
                    score -= 10;
                    recommendations.push('কিছু টুল যোগ করুন');
                }
                
                if (AppState.preferences.securityLevel === 'low') {
                    issues.push('সিকিউরিটি লেভেল কম');
                    score -= 20;
                    recommendations.push('সিকিউরিটি লেভেল বৃদ্ধি করুন');
                }
                
                if (!AppState.isOnline) {
                    issues.push('অফলাইন মোড');
                    score -= 5;
                }
                
                let resultMessage = '';
                if (score === 100) {
                    resultMessage = 'সিকিউরিটি স্ক্যান সম্পন্ন: সবকিছু নিরাপদ!';
                } else if (score >= 80) {
                    resultMessage = `সিকিউরিটি স্ক্যান সম্পন্ন: ভাল অবস্থা (স্কোর: ${score}/100)`;
                } else if (score >= 60) {
                    resultMessage = `সিকিউরিটি স্ক্যান সম্পন্ন: উন্নয়ন প্রয়োজন (স্কোর: ${score}/100)`;
                } else {
                    resultMessage = `সিকিউরিটি স্ক্যান সম্পন্ন: জরুরি মনোযোগ প্রয়োজন (স্কোর: ${score}/100)`;
                }
                
                if (recommendations.length > 0) {
                    resultMessage += '\n\nসুপারিশ:\n• ' + recommendations.join('\n• ');
                }
                
                showNotification(resultMessage.split('\n')[0], score === 100 ? 'success' : score >= 80 ? 'info' : 'warning');
                
                // Show detailed result in terminal
                const terminalInput = document.getElementById('terminalInput');
                if (terminalInput) {
                    terminalInput.value = 'security scan';
                    executeTerminalCommand();
                }
                
                hideLoading();
            }, 2000);
        }
        
        function backupData() {
            try {
                const backup = {
                    timestamp: new Date().toISOString(),
                    version: '4.0',
                    tools: AppState.tools,
                    favorites: AppState.favorites,
                    preferences: AppState.preferences,
                    executionHistory: AppState.executionHistory,
                    exportDate: new Date().toLocaleString('bn-BD'),
                    totalData: {
                        tools: AppState.tools.length,
                        favorites: AppState.favorites.length,
                        executions: AppState.executionHistory.length
                    }
                };
                
                const blob = new Blob([JSON.stringify(backup, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `powerscript-backup-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showNotification('ডেটা ব্যাকআপ সম্পন্ন হয়েছে!', 'success');
            } catch (error) {
                showNotification('ব্যাকআপ তৈরি করতে সমস্যা!', 'error');
            }
        }
        
        function restoreData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                showLoading('ডেটা রিস্টোর হচ্ছে...');
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const backup = JSON.parse(e.target.result);
                        
                        if (!confirm('আপনি কি নিশ্চিত যে বর্তমান ডেটা মুছে ব্যাকআপ থেকে রিস্টোর করতে চান?')) {
                            hideLoading();
                            return;
                        }
                        
                        if (backup.tools && Array.isArray(backup.tools)) {
                            AppState.tools = backup.tools;
                            localStorage.setItem('powerscript_tools', JSON.stringify(backup.tools));
                            
                            if (backup.favorites) {
                                AppState.favorites = backup.favorites;
                                localStorage.setItem('powerscript_favorites', JSON.stringify(backup.favorites));
                            }
                            
                            if (backup.preferences) {
                                AppState.preferences = backup.preferences;
                                localStorage.setItem('powerscript_preferences', JSON.stringify(backup.preferences));
                            }
                            
                            if (backup.executionHistory) {
                                AppState.executionHistory = backup.executionHistory;
                                localStorage.setItem('powerscript_execution_history', JSON.stringify(backup.executionHistory));
                            }
                            
                            updateStats();
                            displayTools();
                            updateExecutionHistory();
                            loadPreferences();
                            applyTheme(AppState.preferences.theme);
                            
                            setTimeout(() => {
                                showNotification('ডেটা সফলভাবে রিস্টোর করা হয়েছে!', 'success');
                                hideLoading();
                            }, 500);
                        } else {
                            showNotification('ব্যাকআপ ফাইল ভুল ফরম্যাট!', 'error');
                            hideLoading();
                        }
                    } catch (error) {
                        showNotification('ব্যাকআপ ফাইল পড়তে সমস্যা!', 'error');
                        hideLoading();
                    }
                };
                
                reader.readAsText(file);
            };
            
            input.click();
        }
        
        function clearAllData() {
            if (!confirm('আপনি কি নিশ্চিত যে সব ডেটা মুছতে চান? এই কাজটি রিভার্স করা যাবে না!')) {
                return;
            }
            
            // Create backup first
            backupData();
            
            // Clear data
            AppState.tools = [];
            AppState.favorites = [];
            AppState.executionHistory = [];
            AppState.preferences = {
                theme: 'dark',
                autoSave: true,
                notifications: true,
                paginationLimit: 12,
                offlineMode: false,
                securityLevel: 'medium'
            };
            
            localStorage.removeItem('powerscript_tools');
            localStorage.removeItem('powerscript_favorites');
            localStorage.removeItem('powerscript_execution_history');
            localStorage.setItem('powerscript_preferences', JSON.stringify(AppState.preferences));
            
            // Update UI
            updateStats();
            displayTools();
            updateExecutionHistory();
            loadPreferences();
            applyTheme(AppState.preferences.theme);
            logout(); // Logout user
            
            showNotification('সমস্ত ডেটা ক্লিয়ার করা হয়েছে!', 'success');
        }
        
        function clearCache() {
            try {
                // Clear localStorage items except preferences
                const keysToKeep = ['powerscript_preferences', 'powerscript_admin_login'];
                const allKeys = Object.keys(localStorage);
                
                allKeys.forEach(key => {
                    if (!keysToKeep.includes(key)) {
                        localStorage.removeItem(key);
                    }
                });
                
                // Clear sessionStorage
                sessionStorage.clear();
                
                // Clear IndexedDB (if any)
                if ('indexedDB' in window) {
                    indexedDB.deleteDatabase('powerscript_db');
                }
                
                showNotification('ক্যাশে ক্লিয়ার করা হয়েছে!', 'success');
            } catch (error) {
                showNotification('ক্যাশে ক্লিয়ার করতে সমস্যা!', 'error');
            }
        }
        
        // ============================================
        // MISC FUNCTIONS
        // ============================================
        
        function exportTools() {
            try {
                const exportData = {
                    version: '4.0',
                    exportDate: new Date().toISOString(),
                    count: AppState.tools.length,
                    tools: AppState.tools
                };
                
                const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `powerscript-tools-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showNotification(`${AppState.tools.length}টি টুল এক্সপোর্ট করা হয়েছে!', 'success`);
            } catch (error) {
                showNotification('টুলস এক্সপোর্ট করতে সমস্যা!', 'error');
            }
        }
        
        function importTools() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                showLoading('টুলস ইম্পোর্ট হচ্ছে...');
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const importData = JSON.parse(e.target.result);
                        
                        if (!importData.tools || !Array.isArray(importData.tools)) {
                            showNotification('ইম্পোর্ট ফাইল ভুল ফরম্যাট!', 'error');
                            hideLoading();
                            return;
                        }
                        
                        const confirmMsg = importData.tools.length > 10 ? 
                            `${importData.tools.length}টি টুল ইম্পোর্ট করতে চান?` :
                            'টুলস ইম্পোর্ট করতে চান?';
                        
                        if (!confirm(confirmMsg)) {
                            hideLoading();
                            return;
                        }
                        
                        // Add imported tools
                        importData.tools.forEach(tool => {
                            if (!AppState.tools.find(t => t.id === tool.id)) {
                                AppState.tools.push({
                                    ...tool,
                                    id: generateId(), // Generate new ID to avoid conflicts
                                    createdAt: new Date().toISOString(),
                                    updatedAt: new Date().toISOString()
                                });
                            }
                        });
                        
                        localStorage.setItem('powerscript_tools', JSON.stringify(AppState.tools));
                        
                        updateStats();
                        displayTools();
                        
                        setTimeout(() => {
                            showNotification(`${importData.tools.length}টি টুল ইম্পোর্ট করা হয়েছে!', 'success`);
                            hideLoading();
                        }, 500);
                    } catch (error) {
                        showNotification('ইম্পোর্ট ফাইল পড়তে সমস্যা!', 'error');
                        hideLoading();
                    }
                };
                
                reader.readAsText(file);
            };
            
            input.click();
        }
        
        function copyToolCode() {
            const tool = AppState.tools.find(t => t.id === AppState.currentToolId);
            if (!tool || !tool.code) return;
            
            navigator.clipboard.writeText(tool.code).then(() => {
                showNotification('কোড কপি করা হয়েছে!', 'success');
            }).catch(() => {
                // Fallback
                const textArea = document.createElement('textarea');
                textArea.value = tool.code;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showNotification('কোড কপি করা হয়েছে!', 'success');
            });
        }
        
        function runToolFromDetail() {
            if (AppState.currentToolId) {
                runTool(AppState.currentToolId);
                closeDetailModal();
            }
        }
        
        function printTools() {
            window.print();
        }
        
        function updateOnlineStatus() {
            AppState.isOnline = navigator.onLine;
            const offlineIndicator = document.getElementById('offlineIndicator');
            const terminalStatus = document.getElementById('terminalStatus');
            
            if (offlineIndicator) {
                if (AppState.isOnline) {
                    offlineIndicator.classList.remove('show');
                } else {
                    offlineIndicator.classList.add('show');
                }
            }
            
            if (terminalStatus) {
                if (AppState.isOnline) {
                    terminalStatus.innerHTML = '<i class="fas fa-circle" style="color: #00ff00; animation: blink 1.5s infinite;"></i> অনলাইন';
                } else {
                    terminalStatus.innerHTML = '<i class="fas fa-circle" style="color: var(--cynthia-warning); animation: blink 1.5s infinite;"></i> অফলাইন';
                }
            }
            
            if (AppState.currentPage === 'settings') {
                const onlineStatus = document.getElementById('onlineStatus');
                if (onlineStatus) {
                    onlineStatus.textContent = AppState.isOnline ? 'হ্যাঁ' : 'না';
                }
            }
        }
        
        // ============================================
        // PWA FUNCTIONALITY
        // ============================================
        
        function setupPWA() {
            // Create manifest
            const manifest = {
                "name": "PowerScript Pro",
                "short_name": "PowerScript",
                "description": "PowerShell টুলস ম্যানেজমেন্ট সিস্টেম",
                "start_url": "/",
                "display": "standalone",
                "background_color": "#0a0a1a",
                "theme_color": "#00f3ff",
                "icons": [
                    {
                        "src": "icon-192.png",
                        "sizes": "192x192",
                        "type": "image/png"
                    },
                    {
                        "src": "icon-512.png",
                        "sizes": "512x512",
                        "type": "image/png"
                    }
                ]
            };
            
            // Add manifest to page
            const manifestLink = document.getElementById('app-manifest');
            const manifestBlob = new Blob([JSON.stringify(manifest)], { type: 'application/json' });
            const manifestUrl = URL.createObjectURL(manifestBlob);
            manifestLink.href = manifestUrl;
            
            // Register service worker
            if ('serviceWorker' in navigator) {
                window.addEventListener('load', () => {
                    navigator.serviceWorker.register('/service-worker.js').catch(error => {
                        if (AppState.debugMode) {
                            console.log('Service Worker registration failed:', error);
                        }
                    });
                });
            }
        }
        
        // ============================================
        // EVENT LISTENERS SETUP
        // ============================================
        
        function setupEventListeners() {
            // Navigation links
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const pageId = this.getAttribute('data-page');
                    if (pageId) {
                        showPage(pageId);
                    }
                });
                
                // Keyboard navigation
                link.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        const pageId = this.getAttribute('data-page');
                        if (pageId) {
                            showPage(pageId);
                        }
                    }
                });
            });
            
            // Skip to content link
            document.getElementById('skipToContent')?.addEventListener('click', function(e) {
                e.preventDefault();
                const mainContent = document.getElementById('main-content');
                if (mainContent) {
                    mainContent.setAttribute('tabindex', '-1');
                    mainContent.focus();
                }
            });
            
            // Home logo
            document.getElementById('homeLogo')?.addEventListener('click', function(e) {
                e.preventDefault();
                showPage('home');
            });
            
            // Theme toggle
            document.getElementById('themeToggle')?.addEventListener('click', function() {
                const currentTheme = AppState.preferences.theme;
                const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                applyTheme(newTheme);
            });
            
            // Login form
            document.getElementById('loginBtn')?.addEventListener('click', handleLogin);
            
            // Tool form
            document.getElementById('toolForm')?.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const name = document.getElementById('toolName').value.trim();
                const code = document.getElementById('toolCode').value.trim();
                const category = document.getElementById('toolCategory').value;
                
                // Clear previous errors
                document.getElementById('toolNameError').style.display = 'none';
                document.getElementById('toolCodeError').style.display = 'none';
                
                let hasError = false;
                
                if (!validateInput(name, 'text')) {
                    document.getElementById('toolNameError').textContent = 'টুলের নাম প্রয়োজন';
                    document.getElementById('toolNameError').style.display = 'block';
                    hasError = true;
                }
                
                if (!validateInput(code, 'code')) {
                    document.getElementById('toolCodeError').textContent = 'কোড কমপক্ষে ১০ অক্ষরের হতে হবে';
                    document.getElementById('toolCodeError').style.display = 'block';
                    hasError = true;
                }
                
                if (!category) {
                    showNotification('ক্যাটাগরি নির্বাচন করুন!', 'warning');
                    hasError = true;
                }
                
                if (hasError) return;
                
                const toolData = {
                    name: name,
                    description: document.getElementById('toolDescription').value.trim(),
                    code: code,
                    category: category
                };
                
                saveTool(toolData);
            });
            
            // Tool operations
            document.getElementById('addToolBtn')?.addEventListener('click', openToolModal);
            document.getElementById('closeToolModal')?.addEventListener('click', closeToolModal);
            document.getElementById('cancelToolBtn')?.addEventListener('click', closeToolModal);
            
            // Tool detail operations
            document.getElementById('closeDetailModal')?.addEventListener('click', closeDetailModal);
            document.getElementById('runToolBtn')?.addEventListener('click', runToolFromDetail);
            document.getElementById('copyCodeBtn')?.addEventListener('click', copyToolCode);
            document.getElementById('downloadCodeBtn')?.addEventListener('click', downloadToolCode);
            document.getElementById('shareToolBtn')?.addEventListener('click', shareTool);
            
            // Logout
            document.getElementById('logoutBtn')?.addEventListener('click', logout);
            
            // Terminal operations
            document.getElementById('terminalInput')?.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    executeTerminalCommand();
                }
            });
            
            document.getElementById('clearTerminalBtn')?.addEventListener('click', clearTerminal);
            document.getElementById('sampleCommandBtn')?.addEventListener('click', runSampleCommand);
            document.getElementById('exportTerminalBtn')?.addEventListener('click', exportTerminalOutput);
            
            // Settings operations
            document.getElementById('securityScanBtn')?.addEventListener('click', runSecurityScan);
            document.getElementById('backupDataBtn')?.addEventListener('click', backupData);
            document.getElementById('restoreDataBtn')?.addEventListener('click', restoreData);
            document.getElementById('clearDataBtn')?.addEventListener('click', clearAllData);
            document.getElementById('clearCacheBtn')?.addEventListener('click', clearCache);
            document.getElementById('savePreferencesBtn')?.addEventListener('click', savePreferences);
            
            // Import/Export tools
            document.getElementById('exportToolsBtn')?.addEventListener('click', exportTools);
            document.getElementById('importToolsBtn')?.addEventListener('click', importTools);
            document.getElementById('printToolsBtn')?.addEventListener('click', printTools);
            
            // Search tools
            document.getElementById('searchTools')?.addEventListener('input', () => {
                AppState.currentPageNumber = 1;
                displayTools();
            });
            
            document.getElementById('homeSearch')?.addEventListener('input', () => {
                AppState.currentPageNumber = 1;
                displayTools();
            });
            
            // Filter and sort
            ['categoryFilter', 'sortBy', 'homeCategoryFilter', 'homeSortBy'].forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('change', () => {
                        AppState.currentPageNumber = 1;
                        displayTools();
                    });
                }
            });
            
            // Subscription
            document.getElementById('subscriptionBtn')?.addEventListener('click', function() {
                showNotification('সাবস্ক্রিপশন ফিচারটি শীঘ্রই আসছে!', 'info');
            });
            
            // Share app
            document.getElementById('shareAppBtn')?.addEventListener('click', function() {
                if (navigator.share) {
                    navigator.share({
                        title: 'PowerScript Pro',
                        text: 'PowerShell টুলস ম্যানেজমেন্ট সিস্টেম',
                        url: window.location.href
                    });
                } else {
                    navigator.clipboard.writeText(window.location.href).then(() => {
                        showNotification('লিংক কপি করা হয়েছে!', 'success');
                    });
                }
            });
            
            // Modal background click to close
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        if (this.id === 'toolModal') closeToolModal();
                        if (this.id === 'toolDetailModal') closeDetailModal();
                        if (this.id === 'loginModal') hideLoginModal();
                    }
                });
            });
            
            // Escape key to close modals
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    closeToolModal();
                    closeDetailModal();
                    hideLoginModal();
                }
                
                // Keyboard shortcuts
                if (e.ctrlKey || e.metaKey) {
                    if (e.key === 'k' || e.key === 'K') {
                        e.preventDefault();
                        const searchBox = document.getElementById('searchTools') || document.getElementById('homeSearch');
                        if (searchBox) {
                            searchBox.focus();
                        }
                    }
                    if (e.key === 'n' || e.key === 'N') {
                        e.preventDefault();
                        openToolModal();
                    }
                    if (e.key === 'l' || e.key === 'L') {
                        e.preventDefault();
                        logout();
                    }
                }
            });
            
            // Online/offline status
            window.addEventListener('online', updateOnlineStatus);
            window.addEventListener('offline', updateOnlineStatus);
            
            // Before unload (save if autoSave is enabled)
            window.addEventListener('beforeunload', function(e) {
                if (AppState.preferences.autoSave) {
                    // Auto-save functionality
                    localStorage.setItem('powerscript_tools', JSON.stringify(AppState.tools));
                    localStorage.setItem('powerscript_favorites', JSON.stringify(AppState.favorites));
                    localStorage.setItem('powerscript_preferences', JSON.stringify(AppState.preferences));
                }
            });
            
            // Error handling
            window.addEventListener('error', function(e) {
                if (AppState.debugMode) {
                    console.error('Application error:', e.error);
                    showNotification(`ত্রুটি: ${e.message}`, 'error');
                }
            });
            
            // Unhandled promise rejection
            window.addEventListener('unhandledrejection', function(e) {
                if (AppState.debugMode) {
                    console.error('Unhandled promise rejection:', e.reason);
                    showNotification('অপ্রত্যাশিত ত্রুটি হয়েছে', 'error');
                }
            });
        }
        
        // ============================================
        // INITIALIZATION
        // ============================================
        
        function initializeApp() {
            // Set current year
            const yearElement = document.getElementById('currentYear');
            if (yearElement) {
                yearElement.textContent = new Date().getFullYear();
            }
            
            // Set app version
            const versionElement = document.getElementById('appVersion');
            if (versionElement) {
                versionElement.textContent = 'v4.0';
            }
            
            // Set last updated
            const lastUpdatedElement = document.getElementById('lastUpdated');
            if (lastUpdatedElement) {
                const today = new Date();
                lastUpdatedElement.textContent = today.toLocaleDateString('bn-BD');
            }
            
            // Apply theme
            applyTheme(AppState.preferences.theme);
            
            // Setup event listeners
            setupEventListeners();
            
            // Check login status
            checkLogin();
            
            // Load tools
            loadTools();
            
            // Load execution history
            updateExecutionHistory();
            
            // Update online status
            updateOnlineStatus();
            
            // Setup PWA
            setupPWA();
            
            // Show initial page
            showPage('home');
            
            // Welcome notification
            setTimeout(() => {
                showNotification('PowerScript Pro v4.0 প্রস্তুত!', 'success');
                
                // Show tooltip for new users
                if (AppState.tools.length === 5) { // Only sample tools
                    setTimeout(() => {
                        showNotification('প্রথম টুল তৈরি করতে উপরের "টুল যুক্ত করুন" বাটনে ক্লিক করুন', 'info', 5000);
                    }, 2000);
                }
            }, 1000);
            
            // Log initialization
            if (AppState.debugMode) {
                console.log('PowerScript Pro initialized:', {
                    tools: AppState.tools.length,
                    favorites: AppState.favorites.length,
                    preferences: AppState.preferences,
                    isAdmin: AppState.isAdmin
                });
            }
        }
        
        // Initialize when DOM is loaded
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeApp);
        } else {
            initializeApp();
        }
        
        // Make functions available globally for onclick handlers
        window.openToolModal = openToolModal;
        window.runTool = runTool;
        window.viewTool = viewTool;
        window.editTool = editTool;
        window.toggleFavorite = toggleFavorite;
        window.goToPage = goToPage;
        
        // Debug function (only in debug mode)
        if (AppState.debugMode) {
            window.debugApp = function() {
                console.log('AppState:', AppState);
                console.log('LocalStorage:', {
                    tools: JSON.parse(localStorage.getItem('powerscript_tools') || '[]').length,
                    favorites: JSON.parse(localStorage.getItem('powerscript_favorites') || '[]'),
                    preferences: JSON.parse(localStorage.getItem('powerscript_preferences') || '{}'),
                    executionHistory: JSON.parse(localStorage.getItem('powerscript_execution_history') || '[]')
                });
            };
        }
    </script>
</body>
</html>